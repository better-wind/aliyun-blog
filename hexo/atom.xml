<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Louis Blog</title>
  <subtitle>Louis/十年</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="//blog.fenghou.site/"/>
  <updated>2017-07-12T10:44:14.419Z</updated>
  <id>//blog.fenghou.site/</id>
  
  <author>
    <name>Louis</name>
    <email>wjf550@qq.com</email>
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>nginx配置https</title>
    <link href="//blog.fenghou.site/2017/07/12/2017-07-12-nginx-ssl/"/>
    <id>//blog.fenghou.site/2017/07/12/2017-07-12-nginx-ssl/</id>
    <published>2017-07-12T09:40:27.000Z</published>
    <updated>2017-07-12T10:44:14.419Z</updated>
    
    <content type="html"><![CDATA[<p>记一发网站升级（http—&gt;https）<br><a id="more"></a></p>
<h3 id="linux-amp-nginx"><a href="#linux-amp-nginx" class="headerlink" title="linux&amp;nginx"></a>linux&amp;nginx</h3><p>这个openssl 是真坑<br>服务器一般是自带openssl<br>nginx配饰https 需要早编译时 将ssl模块打包进来<br>./configure –with-http_ssl_module<br>会报错 找不到openssl whatfuck ？<br>换下面的方法<br>./configure –with-http_ssl_module –with-openssl=/usr/bin/openssl<br>–with-openssl=应该为源文件目录 不是安装目录<br>如果不加 –with-openssl=/usr/bin/openssl 编译不会通过<br>但是可以通过修改 ssl配置文件修改<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"># vi auto/lib/openssl/conf</div><div class="line">CORE_INCS="$CORE_INCS $OPENSSL/.openssl/include"</div><div class="line">CORE_DEPS="$CORE_DEPS $OPENSSL/.openssl/include/openssl/ssl.h"</div><div class="line">CORE_LIBS="$CORE_LIBS $OPENSSL/.openssl/lib/libssl.a"</div><div class="line">CORE_LIBS="$CORE_LIBS $OPENSSL/.openssl/lib/libcrypto.a"</div><div class="line">改为：</div><div class="line">CORE_INCS="$CORE_INCS $OPENSSL/include"</div><div class="line">CORE_DEPS="$CORE_DEPS $OPENSSL/include/openssl/ssl.h"</div><div class="line">CORE_LIBS="$CORE_LIBS $OPENSSL/lib/libssl.a"</div><div class="line">CORE_LIBS="$CORE_LIBS $OPENSSL/lib/libcrypto.a"</div></pre></td></tr></table></figure></p>
<p>但最后make 还是会报错</p>
<p>注意这边重新编译nginx 只需要make<br>make之后 新编译的 nginx在objs下  将它拷贝到 nginx配置目录下的sbin即可</p>
<h3 id="ssl配置"><a href="#ssl配置" class="headerlink" title="ssl配置"></a>ssl配置</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">listen <span class="number">443</span>;</div><div class="line">ssl on;</div><div class="line">ssl_certificate /admin/ali-ssl/fenghou_site.pem;</div><div class="line">ssl_certificate_key /admin/ali-ssl/fenghou_site.key;</div><div class="line">ssl_session_timeout <span class="number">5</span>m;</div><div class="line">ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:ECDHE:ECDH:AES:HIGH:!NULL:!aNULL:!MD5:!ADH:!RC4;</div><div class="line">ssl_protocols TLSv1 TLSv1<span class="number">.1</span> TLSv1<span class="number">.2</span>;</div><div class="line">ssl_prefer_server_ciphers on;</div></pre></td></tr></table></figure>
<p>nginx: [emerg] getpwnam(“www”) failed 错误处理方法</p>
<p>方法一：在nginx.conf中 把user nobody的注释去掉既可</p>
<p>方法二：错误的原因是没有创建www这个用户，应该在服务器系统中添加www用户组和用户www，如下命令：<br>1 /usr/sbin/groupadd -f www<br>2 /usr/sbin/useradd -g www www</p>
<h3 id="证书来源"><a href="#证书来源" class="headerlink" title="证书来源"></a>证书来源</h3><p>startSSL<br>捣腾很久 终于配置成功 微信打开失败<br>。。。。<br>微信不认证<br>重新申请阿里云的 免费ssl证书<br>阿里云 受认证单个域名<br>申请 fenghou.site<br>blog.fenghou.site 还是空白<br>最后 修改ngixn配置<br>。。<br>暂时解决</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;记一发网站升级（http—&amp;gt;https）&lt;br&gt;
    
    </summary>
    
    
      <category term="nginx" scheme="//blog.fenghou.site/tags/nginx/"/>
    
      <category term="https" scheme="//blog.fenghou.site/tags/https/"/>
    
  </entry>
  
  <entry>
    <title>Content-type</title>
    <link href="//blog.fenghou.site/2017/05/17/2017-05-17-content-type/"/>
    <id>//blog.fenghou.site/2017/05/17/2017-05-17-content-type/</id>
    <published>2017-05-17T03:28:09.000Z</published>
    <updated>2017-07-12T10:45:49.231Z</updated>
    
    <content type="html"><![CDATA[<p>暂无查看权限</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;暂无查看权限&lt;/p&gt;

    
    </summary>
    
    
      <category term="http" scheme="//blog.fenghou.site/tags/http/"/>
    
  </entry>
  
  <entry>
    <title>Nginx在前端</title>
    <link href="//blog.fenghou.site/2017/03/31/2017-03-31-nginx-proxy-vue/"/>
    <id>//blog.fenghou.site/2017/03/31/2017-03-31-nginx-proxy-vue/</id>
    <published>2017-03-31T01:55:58.000Z</published>
    <updated>2017-07-12T10:45:49.215Z</updated>
    
    <content type="html"><![CDATA[<p>暂无查看权限</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;暂无查看权限&lt;/p&gt;

    
    </summary>
    
    
      <category term="nginx" scheme="//blog.fenghou.site/tags/nginx/"/>
    
  </entry>
  
  <entry>
    <title>骗到手的第八年@陈妞妞@我才是香坊大呲花</title>
    <link href="//blog.fenghou.site/2017/03/23/2017-03-23-love/"/>
    <id>//blog.fenghou.site/2017/03/23/2017-03-23-love/</id>
    <published>2017-03-23T02:22:59.000Z</published>
    <updated>2017-07-12T10:44:31.324Z</updated>
    
    <content type="html"><![CDATA[<p><iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width="330" height="86" src="https://music.163.com/outchain/player?type=2&id=406346853&auto=0&height=66"></iframe><br><a id="more"></a></p>
<p>八年<br>九十六个月<br>两千九百二十二天</p>
<p><img src="/assets/blogImg/love/IMG_0053.PNG" alt="love"></p>
<p>那会还很瘦的陈妞妞(当然现在也不怎么胖)<br><img src="/assets/blogImg/love/IMG_0045.JPG" alt="love"></p>
<p><img src="/assets/blogImg/love/IMG_0051.JPG" alt="love"><br>(是的，陈妞妞现在的形象)</p>
<p>当陈妞妞意识到自己变胖了以后<br>深深的自责，忏悔着<br>but~~</p>
<p><img src="/assets/blogImg/love/IMG_0040.JPG" alt="love"></p>
<p>高中那会<br>我跟陈妞妞说<br>你负责貌美如花<br>我负责赚钱养家</p>
<p><img src="/assets/blogImg/love/IMG_0047.JPG" alt="love"><br>(I Love You)</p>
<p>现在<br>我正在努力<br>陈妞妞不仅仅是花<br>还兼职当上了小仙女<br>~~~</p>
<p><img src="/assets/blogImg/love/IMG_0054.GIF" alt="love"></p>
<p>多年后<br>幼儿园<br>很多小朋友争得面红耳赤<br>“我妈是老师！”<br>“我爸是警察！”<br>“我爸是局长！”</p>
<p>而我家小孩</p>
<p>云淡风轻 一脸不屑<br>“呵，我妈可是仙女！”</p>
<p><img src="/assets/blogImg/love/IMG_0042.JPG" alt="love"><br>(该打赏打赏，都别客气)</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;iframe frameborder=&quot;no&quot; border=&quot;0&quot; marginwidth=&quot;0&quot; marginheight=&quot;0&quot; width=330 height=86
src=&quot;https://music.163.com/outchain/player?type=2&amp;id=406346853&amp;auto=0&amp;height=66&quot;&gt;&lt;/iframe&gt;&lt;br&gt;
    
    </summary>
    
    
      <category term="随笔" scheme="//blog.fenghou.site/tags/%E9%9A%8F%E7%AC%94/"/>
    
  </entry>
  
  <entry>
    <title>此去经年@我才是香坊大呲花</title>
    <link href="//blog.fenghou.site/2017/03/22/2017-03-21-diary/"/>
    <id>//blog.fenghou.site/2017/03/22/2017-03-21-diary/</id>
    <published>2017-03-22T06:05:31.000Z</published>
    <updated>2017-07-12T10:44:45.177Z</updated>
    
    <content type="html"><![CDATA[<p><iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width="330" height="86" src="https://music.163.com/outchain/player?type=2&id=187908&auto=0&height=66"></iframe><br><a id="more"></a></p>
<p>昨天跟同事一起去打球<br>还没开始打，热身阶段投了会儿球<br>完了，跟跑完1000米一样一样的<br>后来还硬是打了快俩小时<br>今天全身酸爽的不行<br>连走路都走不顺</p>
<p>唉 老是真的老了<br>想想上次打球<br>还是去年毕业前最后的寝室南北对抗赛</p>
<p><img src="/assets/blogImg/2017-03-21-basekitball.jpg" alt="脆皮鸡"><br>(拍照那小子，问什么不把我照进去)</p>
<p>那会虽然体重跟现在差了略微几斤<br>但是照样能跑能跳</p>
<p>大学不是一点儿好处没有<br>它能洗去人的浮华<br>同时让人意志消磨<br>多愁善感<br>酒量大增(有吗)</p>
<p><img src="/assets/blogImg/2017-03-21-study.jpg" alt="脆皮鸡"></p>
<p><img src="/assets/blogImg/2017-03-21-IMG_0048.jpg" alt="脆皮鸡"><br>真正的成长或许就是<br>你开始低下了头<br>无论在行走还是坐着的时候<br>当头颅微微低下成为你日常生活中的主要姿势<br>你就真的长大了<br>总仰着脑袋的一定小屁孩<br>以为自己很牛x<br>其实差远了<br><img src="/assets/blogImg/2017-03-21-IMG_0050.jpg" alt="脆皮鸡"></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;iframe frameborder=&quot;no&quot; border=&quot;0&quot; marginwidth=&quot;0&quot; marginheight=&quot;0&quot; width=330 height=86
src=&quot;https://music.163.com/outchain/player?type=2&amp;id=187908&amp;auto=0&amp;height=66&quot;&gt;&lt;/iframe&gt;&lt;br&gt;
    
    </summary>
    
    
      <category term="随想" scheme="//blog.fenghou.site/tags/%E9%9A%8F%E6%83%B3/"/>
    
      <category term="js" scheme="//blog.fenghou.site/tags/js/"/>
    
  </entry>
  
  <entry>
    <title>基于Vue的CPS后台</title>
    <link href="//blog.fenghou.site/2017/02/27/2017-02-27-%E5%9F%BA%E4%BA%8EVue%E7%9A%84CPS%E5%90%8E%E5%8F%B0/"/>
    <id>//blog.fenghou.site/2017/02/27/2017-02-27-基于Vue的CPS后台/</id>
    <published>2017-02-27T11:17:43.000Z</published>
    <updated>2017-03-15T11:22:58.483Z</updated>
    
    <content type="html"><![CDATA[<p>上周结束了在想去的最后一个项目<br>公众号联盟的推广后台<br><a id="more"></a></p>
<h3 id="技术栈"><a href="#技术栈" class="headerlink" title="技术栈"></a>技术栈</h3><p>vue<br>应该不需要介绍<br>vuex<br>巴拉巴拉巴拉<br>vue-router<br>。。。。<br>webpack<br>这次用的版本是2.x跟1.x的配置还是有点出入</p>
<h3 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h3><p>将整个后台按功能抽离成单独的模块<br>header 模块<br>footer 模块<br>menu 模块<br>page 分页模块<br>and 具体功能模块<br>balabalabalabala~~~<br>其实也没什么好说的。。。</p>
<h3 id="坑"><a href="#坑" class="headerlink" title="坑"></a>坑</h3><p>还是有不少值得注意的地方的</p>
<blockquote>
<p>路由切换中页面的刷新<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//监听路由变化</span></div><div class="line">watch: &#123;</div><div class="line">      <span class="string">'$route'</span> (to, <span class="keyword">from</span>) &#123;</div><div class="line">        <span class="keyword">if</span> (to.fullPath !== <span class="keyword">from</span>.fullPath) &#123;</div><div class="line">          <span class="keyword">this</span>.pageInt() <span class="comment">// 刷新处理</span></div><div class="line">        &#125;</div><div class="line">      &#125;</div><div class="line">    &#125;</div></pre></td></tr></table></figure></p>
<p>store交互数据的延迟<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//返回异步操作</span></div><div class="line"><span class="comment">//actions</span></div><div class="line">getOrder (&#123;commit&#125;, data) &#123;</div><div class="line">    <span class="keyword">const</span> opts = &#123;</div><div class="line">      <span class="attr">type</span>: <span class="string">'POST'</span>,</div><div class="line">      <span class="attr">url</span>: <span class="string">'/union/order/list'</span>,</div><div class="line">      <span class="attr">data</span>: data</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> fetchLoading(commit, <span class="string">'SET_ORDER'</span>, opts)</div><div class="line">&#125;</div><div class="line"><span class="keyword">const</span> fetchLoading = <span class="function">(<span class="params">commit, fn, opts</span>) =&gt;</span> &#123;</div><div class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</div><div class="line">    beginLoading(commit)</div><div class="line">    Util.fetch(opts)</div><div class="line">      .then(<span class="function"><span class="params">response</span> =&gt;</span> &#123;</div><div class="line">        stopLoading(commit)</div><div class="line">        <span class="keyword">if</span> (fn) &#123;</div><div class="line">          commit(fn, response)</div><div class="line">          resolve()</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">          resolve(response)</div><div class="line">        &#125;</div><div class="line">      &#125;, error =&gt; &#123;</div><div class="line">        stopLoading(commit)</div><div class="line">        <span class="keyword">const</span> config = &#123;</div><div class="line">          <span class="attr">isShow</span>: <span class="literal">true</span>,</div><div class="line">          <span class="attr">isToast</span>: <span class="literal">true</span>,</div><div class="line">          <span class="attr">toastConfig</span>: &#123;</div><div class="line">            <span class="attr">toastMsg</span>: <span class="string">'系统繁忙,请稍后再试'</span></div><div class="line">          &#125;</div><div class="line">        &#125;</div><div class="line">        commit(<span class="string">'SET_POP'</span>, config)</div><div class="line">        <span class="built_in">console</span>.error(error)</div><div class="line">      &#125;)</div><div class="line">  &#125;)</div><div class="line">&#125;</div><div class="line"><span class="comment">//模块中调用actions中方法</span></div><div class="line"><span class="keyword">this</span>.getOrder(opts)</div><div class="line">          .then(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</div><div class="line">            <span class="keyword">this</span>.getPaging(opts)</div><div class="line">          &#125;)</div></pre></td></tr></table></figure></p>
</blockquote>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>估计这周就离职了<br>额，就这样吧</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;上周结束了在想去的最后一个项目&lt;br&gt;公众号联盟的推广后台&lt;br&gt;
    
    </summary>
    
    
      <category term="webpack" scheme="//blog.fenghou.site/tags/webpack/"/>
    
      <category term="vue" scheme="//blog.fenghou.site/tags/vue/"/>
    
      <category term="es6" scheme="//blog.fenghou.site/tags/es6/"/>
    
  </entry>
  
  <entry>
    <title>Weex</title>
    <link href="//blog.fenghou.site/2017/02/21/2017-02-21-Weex/"/>
    <id>//blog.fenghou.site/2017/02/21/2017-02-21-Weex/</id>
    <published>2017-02-21T11:17:14.000Z</published>
    <updated>2017-03-21T06:07:06.855Z</updated>
    
    <content type="html"><![CDATA[<p>我就是个标题</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;我就是个标题&lt;/p&gt;

    
    </summary>
    
    
      <category term="weex" scheme="//blog.fenghou.site/tags/weex/"/>
    
  </entry>
  
  <entry>
    <title>Rax</title>
    <link href="//blog.fenghou.site/2017/02/17/2017-02-17-Rax/"/>
    <id>//blog.fenghou.site/2017/02/17/2017-02-17-Rax/</id>
    <published>2017-02-17T11:16:59.000Z</published>
    <updated>2017-03-21T06:07:06.842Z</updated>
    
    <content type="html"><![CDATA[<p>我就是个标题</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;我就是个标题&lt;/p&gt;

    
    </summary>
    
    
      <category term="rax" scheme="//blog.fenghou.site/tags/rax/"/>
    
  </entry>
  
  <entry>
    <title>PReact</title>
    <link href="//blog.fenghou.site/2017/02/13/2017-02-13-PReact/"/>
    <id>//blog.fenghou.site/2017/02/13/2017-02-13-PReact/</id>
    <published>2017-02-13T11:16:39.000Z</published>
    <updated>2017-03-21T06:07:11.041Z</updated>
    
    <content type="html"><![CDATA[<p>我就是个标题</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;我就是个标题&lt;/p&gt;

    
    </summary>
    
    
      <category term="PReact" scheme="//blog.fenghou.site/tags/PReact/"/>
    
  </entry>
  
  <entry>
    <title>wx签名出错-URL</title>
    <link href="//blog.fenghou.site/2017/02/13/2017-02-13-wx%E7%AD%BE%E5%90%8D%E5%87%BA%E9%94%99-URL/"/>
    <id>//blog.fenghou.site/2017/02/13/2017-02-13-wx签名出错-URL/</id>
    <published>2017-02-13T11:16:16.000Z</published>
    <updated>2017-03-15T11:26:35.691Z</updated>
    
    <content type="html"><![CDATA[<p>上周调试wx收货地址的时候<br>碰到一个签名出错的问题<br>invalid signature<br><a id="more"></a></p>
<h3 id="前提"><a href="#前提" class="headerlink" title="前提"></a>前提</h3><p>为了增强用户体验<br>在下单页选择收货地址的时候<br>如果是微信用户<br>新增添加微信地址的功能</p>
<h3 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h3><p>调用wxAPI获取地址信息<br>转换地址信息格式<br>将新地址保存</p>
<h3 id="注意点"><a href="#注意点" class="headerlink" title="注意点"></a>注意点</h3><p>wx.openAddress方法中<br>cancel回调是取消选项</p>
<p>wx地址选择中北京天津等自治区<br>新增县选项<br>北京市 北京市 朝阳区<br>北京市 县 密云县</p>
<h3 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h3><p>因为方便测试<br>打开页面的方式都是通过<br>打开指定连接的形式<br><a href="http://www.xiangqu.com/order/submit/view?skuMap[q90060]=1" target="_blank" rel="external">http://www.xiangqu.com/order/submit/view?skuMap[q90060]=1</a><br>一切OK<br>但是从商品详情页进入<br>在选择SKU下单的时候<br>wx.openAddress会调用不了<br>也就是 直接打开 <a href="http://www.xiangqu.com/order/submit/view?skuMap[q90060]=1" target="_blank" rel="external">http://www.xiangqu.com/order/submit/view?skuMap[q90060]=1</a> 正常<br>先进商品详情页 ==&gt; <a href="http://www.xiangqu.com/order/submit/view?skuMap[q90060]=1" target="_blank" rel="external">http://www.xiangqu.com/order/submit/view?skuMap[q90060]=1</a> 异常<br>invalid signature</p>
<h3 id="解决"><a href="#解决" class="headerlink" title="解决"></a>解决</h3><p>直接打开链接<br>wx浏览器会对url连接进行转码(encode)<br>wx浏览器内部连接跳转<br>不会对url进行转码处理</p>
<p>wx验证签名信息的时候<br>会将当前页面的链接进行转码处理(encode)</p>
<p>所以<br>直接打开 <a href="http://www.xiangqu.com/order/submit/view?skuMap[q90060" target="_blank" rel="external">http://www.xiangqu.com/order/submit/view?skuMap[q90060</a>] = 1<br>wx的验证的URL = <a href="http://www.xiangqu.com/order/submit/view?skuMap%5Bq90060%5D=1" target="_blank" rel="external">http://www.xiangqu.com/order/submit/view?skuMap%5Bq90060%5D=1</a><br>服务端验证的URL = <a href="http://www.xiangqu.com/order/submit/view?skuMap%5Bq90060%5D=1" target="_blank" rel="external">http://www.xiangqu.com/order/submit/view?skuMap%5Bq90060%5D=1</a></p>
<p>间接打开的 <a href="http://www.xiangqu.com/order/submit/view?skuMap[q90060]=1" target="_blank" rel="external">http://www.xiangqu.com/order/submit/view?skuMap[q90060]=1</a><br>wx的验证的URL = <a href="http://www.xiangqu.com/order/submit/view?skuMap%5Bq90060%5D=1" target="_blank" rel="external">http://www.xiangqu.com/order/submit/view?skuMap%5Bq90060%5D=1</a><br>服务端验证的URL = <a href="http://www.xiangqu.com/order/submit/view?skuMap[q90060]=1" target="_blank" rel="external">http://www.xiangqu.com/order/submit/view?skuMap[q90060]=1</a></p>
<p>解决方法很简单<br>在跳转的时候<br>js先对链接进行转码</p>
<h3 id="延伸"><a href="#延伸" class="headerlink" title="延伸"></a>延伸</h3><p>在处理url编码问题的时候<br>最好的方法就是Javascript先对URL进行编码<br>不通过浏览器编码<br>保证输出结果和服务器得到数据的一致</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;上周调试wx收货地址的时候&lt;br&gt;碰到一个签名出错的问题&lt;br&gt;invalid signature&lt;br&gt;
    
    </summary>
    
    
      <category term="wx" scheme="//blog.fenghou.site/tags/wx/"/>
    
  </entry>
  
  <entry>
    <title>react-redux</title>
    <link href="//blog.fenghou.site/2017/02/05/2017-02-05-react-redux/"/>
    <id>//blog.fenghou.site/2017/02/05/2017-02-05-react-redux/</id>
    <published>2017-02-05T11:15:42.000Z</published>
    <updated>2017-03-21T06:07:15.334Z</updated>
    
    <content type="html"><![CDATA[<p>我就是个标题</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;我就是个标题&lt;/p&gt;

    
    </summary>
    
    
      <category term="react" scheme="//blog.fenghou.site/tags/react/"/>
    
  </entry>
  
  <entry>
    <title>react-flux</title>
    <link href="//blog.fenghou.site/2017/02/04/2017-02-04-react-flux/"/>
    <id>//blog.fenghou.site/2017/02/04/2017-02-04-react-flux/</id>
    <published>2017-02-04T11:15:20.000Z</published>
    <updated>2017-03-21T06:07:19.920Z</updated>
    
    <content type="html"><![CDATA[<p>我就是个标题</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;我就是个标题&lt;/p&gt;

    
    </summary>
    
    
      <category term="react" scheme="//blog.fenghou.site/tags/react/"/>
    
  </entry>
  
  <entry>
    <title>react-immutable</title>
    <link href="//blog.fenghou.site/2017/02/03/2017-02-03-react-immutable/"/>
    <id>//blog.fenghou.site/2017/02/03/2017-02-03-react-immutable/</id>
    <published>2017-02-03T11:14:58.000Z</published>
    <updated>2017-03-21T06:07:24.440Z</updated>
    
    <content type="html"><![CDATA[<p>我就是个标题</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;我就是个标题&lt;/p&gt;

    
    </summary>
    
    
      <category term="react" scheme="//blog.fenghou.site/tags/react/"/>
    
  </entry>
  
  <entry>
    <title>Canvas--毛笔字书法</title>
    <link href="//blog.fenghou.site/2017/01/21/2017-01-21-Canvas%E6%AF%9B%E7%AC%94%E5%AD%97%E4%B9%A6%E6%B3%95/"/>
    <id>//blog.fenghou.site/2017/01/21/2017-01-21-Canvas毛笔字书法/</id>
    <published>2017-01-21T11:14:18.000Z</published>
    <updated>2017-03-15T11:31:18.251Z</updated>
    
    <content type="html"><![CDATA[<p>继续Canvas<br>这次记录移动端手写书法的实现<br><a id="more"></a></p>
<h3 id="抛出问题"><a href="#抛出问题" class="headerlink" title="抛出问题"></a>抛出问题</h3><p>canvas在移动端应用书法<br>需要解决两个问题<br>1.笔锋问题<br>2.连贯问题</p>
<h3 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h3><p>首先分析一下<br>毛笔字是有笔锋的<br>又粗有细有勾有钩<br>通过点击时间长短决定画笔大小<br>来模拟毛笔力度</p>
<p>通过touchmove事件获取连续移动的两个点<br>计算两点间的直线距离<br>通过循环在canvas画图</p>
<h3 id="代码上"><a href="#代码上" class="headerlink" title="代码上"></a>代码上</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> domCanvas = <span class="built_in">document</span>.querySelector(<span class="string">'#Calligraphy'</span>),</div><div class="line">        context = domCanvas.getContext(<span class="string">'2d'</span>),</div><div class="line">        CONFIG = &#123;</div><div class="line">            <span class="attr">lineMin</span>:<span class="number">8</span>,</div><div class="line">            <span class="attr">lineMax</span>:<span class="number">20</span>,</div><div class="line">            <span class="attr">radius</span>:<span class="number">0</span></div><div class="line">        &#125;;</div><div class="line">    <span class="keyword">let</span> Calligraphy = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">        <span class="keyword">this</span>.touchFlog = <span class="literal">false</span>;</div><div class="line">        <span class="keyword">this</span>.hasEvent = [];  <span class="comment">//move数组</span></div><div class="line">        <span class="keyword">this</span>.upEvent = <span class="literal">null</span>; <span class="comment">//当前操作</span></div><div class="line">        <span class="keyword">this</span>.limitDis = <span class="number">80</span>; <span class="comment">//移动最少距离</span></div><div class="line">        <span class="keyword">this</span>.radius = CONFIG.radius;</div><div class="line">        <span class="keyword">this</span>.lineMin = CONFIG.lineMin;</div><div class="line">        <span class="keyword">this</span>.lineMax = CONFIG.lineMax;</div><div class="line">    &#125;</div><div class="line">    Calligraphy.prototype = &#123;</div><div class="line">        <span class="attr">start</span>:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">            <span class="comment">//开始执行监听事件</span></div><div class="line">            <span class="keyword">this</span>.bindEventDown = <span class="keyword">this</span>.eventDown.bind(<span class="keyword">this</span>);</div><div class="line">            <span class="keyword">this</span>.bindEventMove = <span class="keyword">this</span>.eventMove.bind(<span class="keyword">this</span>);</div><div class="line">            <span class="keyword">this</span>.bindEventUp= <span class="keyword">this</span>.eventUp.bind(<span class="keyword">this</span>);</div><div class="line">            domCanvas.addEventListener(<span class="string">'touchstart'</span>,<span class="keyword">this</span>.eventDown)</div><div class="line">            domCanvas.addEventListener(<span class="string">'touchmove'</span>,<span class="keyword">this</span>.bindEventMove)</div><div class="line">            domCanvas.addEventListener(<span class="string">'touchend'</span>,<span class="keyword">this</span>.bindEventUp)</div><div class="line">        &#125;,</div><div class="line">        <span class="attr">eventDown</span>:<span class="function"><span class="keyword">function</span>(<span class="params">e</span>)</span>&#123;</div><div class="line">            <span class="built_in">console</span>.log(<span class="string">'Down'</span>)</div><div class="line">            e.preventDefault();</div><div class="line">            <span class="keyword">let</span> target = e.changedTouches[e.changedTouches.length<span class="number">-1</span>];</div><div class="line">            <span class="keyword">this</span>.touchFlog = <span class="literal">true</span>;</div><div class="line">            <span class="keyword">this</span>.hasEvent = [];  <span class="comment">//</span></div><div class="line">            <span class="keyword">this</span>.upEvent = <span class="keyword">this</span>.getPoint(target); <span class="comment">//当前操作</span></div><div class="line">        &#125;,</div><div class="line">        <span class="attr">eventMove</span>:<span class="function"><span class="keyword">function</span>(<span class="params">e</span>)</span>&#123;</div><div class="line">            <span class="built_in">console</span>.log(<span class="string">'Move'</span>);</div><div class="line">            <span class="keyword">let</span> target = e.changedTouches[e.changedTouches.length<span class="number">-1</span>];</div><div class="line">            <span class="keyword">this</span>.drawFont(<span class="keyword">this</span>.getPoint(target))</div><div class="line">        &#125;,</div><div class="line">        <span class="attr">eventUp</span>:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">            <span class="built_in">console</span>.log(<span class="string">'Up'</span>);</div><div class="line">            e.preventDefault();</div><div class="line">            <span class="keyword">this</span>.moveFlog = <span class="literal">false</span>;</div><div class="line">        &#125;,</div><div class="line">        <span class="attr">drawFont</span>:<span class="function"><span class="keyword">function</span>(<span class="params">point</span>)</span>&#123;</div><div class="line">            <span class="keyword">if</span>(!<span class="keyword">this</span>.touchFlog)</div><div class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">            <span class="keyword">let</span> moEvent = point,</div><div class="line">                upEvent = <span class="keyword">this</span>.upEvent,</div><div class="line">                upRadius = <span class="keyword">this</span>.radius,</div><div class="line">                dis = <span class="number">0</span>, <span class="comment">//连续点距离</span></div><div class="line">                time = <span class="number">0</span>; <span class="comment">//时间</span></div><div class="line">            <span class="keyword">this</span>.hasEvent.unshift(&#123;<span class="attr">time</span>:<span class="keyword">new</span> <span class="built_in">Date</span>().getTime(),<span class="attr">dis</span>:<span class="keyword">this</span>.getDistance(upEvent,moEvent)&#125;);</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">let</span> n = <span class="number">0</span>; n &lt; <span class="keyword">this</span>.hasEvent.length<span class="number">-1</span>; n++) &#123;</div><div class="line">                dis += <span class="keyword">this</span>.hasEvent[n].dis;</div><div class="line">                time += <span class="keyword">this</span>.hasEvent[n].time-<span class="keyword">this</span>.hasEvent[n+<span class="number">1</span>].time;</div><div class="line">                <span class="keyword">if</span> (dis&gt;<span class="keyword">this</span>.limitDis)</div><div class="line">                    <span class="keyword">break</span>;</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">let</span> radius = <span class="built_in">Math</span>.min(time/dis+<span class="keyword">this</span>.lineMin,<span class="keyword">this</span>.lineMax)/<span class="number">2</span>; <span class="comment">//计算这次画笔半径</span></div><div class="line">            <span class="keyword">this</span>.radius = radius;</div><div class="line">            <span class="keyword">this</span>.upEvent = moEvent;</div><div class="line">            <span class="keyword">let</span> len = <span class="built_in">Math</span>.round(<span class="keyword">this</span>.hasEvent[<span class="number">0</span>].dis/<span class="number">2</span>)+<span class="number">1</span>;</div><div class="line">            <span class="comment">//跟上次画笔半径渐变</span></div><div class="line">            <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; len; i++) &#123;</div><div class="line">                <span class="keyword">let</span> x = upEvent.x + (moEvent.x-upEvent.x)/len* i,</div><div class="line">                    y = upEvent.y + (moEvent.y-upEvent.y)/len* i,</div><div class="line">                    r = upRadius + (radius-upRadius)/len*i;</div><div class="line">                context.beginPath();</div><div class="line">                context.arc(x,y,r,<span class="number">0</span>,<span class="number">2</span>*<span class="built_in">Math</span>.PI,<span class="literal">true</span>);</div><div class="line">                context.fill();</div><div class="line">            &#125;</div><div class="line">        &#125;,</div><div class="line">        <span class="attr">getPoint</span>:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">            <span class="keyword">return</span> &#123;</div><div class="line">                <span class="attr">x</span>: e.clientX - domCanvas.offsetLeft + (<span class="built_in">document</span>.body.scrollLeft || <span class="built_in">document</span>.documentElement.scrollLeft),</div><div class="line">                <span class="attr">y</span>: e.clientY - domCanvas.offsetTop + (<span class="built_in">document</span>.body.scrollLeft || <span class="built_in">document</span>.documentElement.scrollTop),</div><div class="line">            &#125;</div><div class="line">        &#125;,</div><div class="line">        <span class="attr">getDistance</span>: <span class="function"><span class="keyword">function</span>(<span class="params">pre,next</span>)</span>&#123;</div><div class="line">            <span class="keyword">let</span> x = next.x - pre.x,</div><div class="line">                y = next.y - pre.y;</div><div class="line">            <span class="keyword">return</span> <span class="built_in">Math</span>.sqrt(x*x + y*y);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">let</span> calligrapgy = <span class="keyword">new</span> Calligraphy();</div><div class="line">    calligrapgy.start();</div></pre></td></tr></table></figure>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;继续Canvas&lt;br&gt;这次记录移动端手写书法的实现&lt;br&gt;
    
    </summary>
    
    
      <category term="canvas" scheme="//blog.fenghou.site/tags/canvas/"/>
    
  </entry>
  
  <entry>
    <title>Canvas--黑凤梨</title>
    <link href="//blog.fenghou.site/2017/01/20/2017-01-20-Canvas%E9%BB%91%E5%87%A4%E6%A2%A8/"/>
    <id>//blog.fenghou.site/2017/01/20/2017-01-20-Canvas黑凤梨/</id>
    <published>2017-01-20T11:13:46.000Z</published>
    <updated>2017-03-15T11:34:33.356Z</updated>
    
    <content type="html"><![CDATA[<p>之前很火的黑凤梨生成性格图片<br>相信大家印象深刻<br>短时间拉了大量粉丝，同时自个儿也被微信封了<br><a id="more"></a><br>我们公司当时也做了一个类似的活动<br>想去治病！</p>
<h3 id="活动流程"><a href="#活动流程" class="headerlink" title="活动流程"></a>活动流程</h3><p><img src="http://xqproduct.xiangqu.com/FqDKF5UELtMrxWcGd33YSKEVM3Xq?imageView2/2/w/250/q/90/format/jpg/1352x1580/" alt="黑凤梨"><br>通过输入生日年月，确定星座<br>每个新座对应几个不同的病症<br>每个病症对应几段不同的文案和商品<br>诊断结果可以分享</p>
<h3 id="初步想法"><a href="#初步想法" class="headerlink" title="初步想法"></a>初步想法</h3><p>前端通过canvas实现结果图片<br>通过toDataURL转成Image<br>用微信浏览器自带保存图片功能</p>
<h3 id="遇到的问题"><a href="#遇到的问题" class="headerlink" title="遇到的问题"></a>遇到的问题</h3><p>设计师希望采用第三方字体<br>那显然在前端实现这有点坑用户流量<br>中文不是就26个字母<br>常用词汇加起来2500 大概7M左右<br>这还是一种字体<br>要实现设计稿要求<br>至少需要三种字体</p>
<h3 id="解决办法"><a href="#解决办法" class="headerlink" title="解决办法"></a>解决办法</h3><p>将字体资源放到服务器<br>有服务端实现生成图片<br>前端上传生成格式和内容</p>
<h3 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h3><p>在代码实现上前端没有什么大问题<br>主要是数据格式的规定上<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> XZ = &#123;</div><div class="line">    <span class="string">'1'</span>:&#123;</div><div class="line">        <span class="attr">division</span>:<span class="number">19</span>,</div><div class="line">        <span class="attr">items</span>:[<span class="string">'MJ'</span>,<span class="string">'SP'</span>]</div><div class="line">    &#125;,</div><div class="line">    <span class="string">'2'</span>:&#123;</div><div class="line">        <span class="attr">division</span>:<span class="number">18</span>,</div><div class="line">        <span class="attr">items</span>:[<span class="string">'SP'</span>,<span class="string">'SY'</span>]</div><div class="line">    &#125;,</div><div class="line">    <span class="string">'3'</span>:&#123;</div><div class="line">        <span class="attr">division</span>:<span class="number">20</span>,</div><div class="line">        <span class="attr">items</span>:[<span class="string">'SY'</span>,<span class="string">'BY'</span>]</div><div class="line">    &#125;,</div><div class="line">    <span class="string">'4'</span>:&#123;</div><div class="line">        <span class="attr">division</span>:<span class="number">19</span>,</div><div class="line">        <span class="attr">items</span>:[<span class="string">'BY'</span>,<span class="string">'JN'</span>]</div><div class="line">    &#125;,</div><div class="line">    <span class="string">'5'</span>:&#123;</div><div class="line">        <span class="attr">division</span>:<span class="number">20</span>,</div><div class="line">        <span class="attr">items</span>:[<span class="string">'JN'</span>,<span class="string">'SdZ'</span>]</div><div class="line">    &#125;,</div><div class="line">    <span class="string">'6'</span>:&#123;</div><div class="line">        <span class="attr">division</span>:<span class="number">21</span>,</div><div class="line">        <span class="attr">items</span>:[<span class="string">'SdZ'</span>,<span class="string">'JX'</span>]</div><div class="line">    &#125;,</div><div class="line">    <span class="string">'7'</span>:&#123;</div><div class="line">        <span class="attr">division</span>:<span class="number">22</span>,</div><div class="line">        <span class="attr">items</span>:[<span class="string">'JX'</span>,<span class="string">'SlZ'</span>]</div><div class="line">    &#125;,</div><div class="line">    <span class="string">'8'</span>:&#123;</div><div class="line">        <span class="attr">division</span>:<span class="number">22</span>,</div><div class="line">        <span class="attr">items</span>:[<span class="string">'SlZ'</span>,<span class="string">'CN'</span>]</div><div class="line">    &#125;,</div><div class="line">    <span class="string">'9'</span>:&#123;</div><div class="line">        <span class="attr">division</span>:<span class="number">22</span>,</div><div class="line">        <span class="attr">items</span>:[<span class="string">'CN'</span>,<span class="string">'TC'</span>]</div><div class="line">    &#125;,</div><div class="line">    <span class="string">'10'</span>:&#123;</div><div class="line">        <span class="attr">division</span>:<span class="number">23</span>,</div><div class="line">        <span class="attr">items</span>:[<span class="string">'TC'</span>,<span class="string">'TX'</span>]</div><div class="line">    &#125;,</div><div class="line">    <span class="string">'11'</span>:&#123;</div><div class="line">        <span class="attr">division</span>:<span class="number">22</span>,</div><div class="line">        <span class="attr">items</span>:[<span class="string">'TX'</span>,<span class="string">'SS'</span>]</div><div class="line">    &#125;,</div><div class="line">    <span class="string">'12'</span>:&#123;</div><div class="line">        <span class="attr">division</span>:<span class="number">21</span>,</div><div class="line">        <span class="attr">items</span>:[<span class="string">'SS'</span>,<span class="string">'MJ'</span>]</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="comment">//星座的判别</span></div><div class="line"><span class="keyword">let</span> oXz = XZ[domInputMonth];</div><div class="line">    sXz = domInputDate &lt;= oXz.division ? oXz.item[<span class="number">0</span>] : oXz.item[<span class="number">1</span>];</div><div class="line"><span class="comment">//病症描述的格式规定</span></div><div class="line">[<span class="string">'$+@70@&amp;方正兰亭特黑简体&amp;**+$$+@50@&amp;方正兰亭特黑简体&amp;想发个朋友圈+$'</span>,<span class="string">'结果..$+@50@&amp;方正兰亭特黑简体&amp;俩小时+$过去了...'</span>,<span class="string">'还在$+@110@&amp;方正兰亭特黑简体&amp;选照片+$'</span>]</div><div class="line">文案分行采取数组形式</div><div class="line">$+ +$ 包含有特殊字体文本</div><div class="line">&amp; &amp;   特殊字体</div><div class="line">@ @   字号</div><div class="line">**    替换文案(姓名)</div><div class="line"><span class="comment">//生成文案在显示位置</span></div><div class="line">通过本地Canvas模拟生成的图片</div><div class="line">(字体用系统字体代替)</div><div class="line">context.ctx.font = nSize+<span class="string">'px arial'</span>;</div><div class="line">context.measureText(sContext).width 来获取长度</div><div class="line">通过指定宽度容器的比较获取x,y坐标</div><div class="line"><span class="comment">//小技巧</span></div><div class="line"><span class="comment">//数组的随机</span></div><div class="line"><span class="built_in">Array</span>.prototype.shuffle = <span class="function"><span class="keyword">function</span>(<span class="params">n</span>)</span>&#123;</div><div class="line">            <span class="keyword">let</span> len = <span class="keyword">this</span>.length,num = n ? <span class="built_in">Math</span>.min(n,len) : len,index,</div><div class="line">                arr = <span class="keyword">this</span>.slice(<span class="number">0</span>),temp,</div><div class="line">                lib = &#123;&#125;;</div><div class="line">            lib.range = <span class="function"><span class="keyword">function</span>(<span class="params">min,max</span>)</span>&#123;</div><div class="line">                <span class="keyword">return</span> min + <span class="built_in">Math</span>.floor(<span class="built_in">Math</span>.random()*(max-min+<span class="number">1</span>))</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">for</span>(<span class="keyword">let</span> i =<span class="number">0</span>;i&lt;len;i++)&#123;</div><div class="line">                index = lib.range(i,len<span class="number">-1</span>);</div><div class="line">                temp = arr[i];</div><div class="line">                arr[i] = arr[index];</div><div class="line">                arr[index] = temp;</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">return</span> arr.slice(<span class="number">0</span>,num);</div><div class="line">        &#125;</div><div class="line"><span class="comment">//两个数组的合并</span></div><div class="line">[a].concat([b])  返回结果新数组</div><div class="line">[].push.apply([a],[b]);返回结果[a]</div></pre></td></tr></table></figure></p>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>虽然好像跟canvas关系不大<br>但是，好像也没有但是。。。</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;之前很火的黑凤梨生成性格图片&lt;br&gt;相信大家印象深刻&lt;br&gt;短时间拉了大量粉丝，同时自个儿也被微信封了&lt;br&gt;
    
    </summary>
    
    
      <category term="canvas" scheme="//blog.fenghou.site/tags/canvas/"/>
    
  </entry>
  
  <entry>
    <title>Canvas--星空</title>
    <link href="//blog.fenghou.site/2017/01/19/2017-01-19-Canvas%E6%98%9F%E7%A9%BA/"/>
    <id>//blog.fenghou.site/2017/01/19/2017-01-19-Canvas星空/</id>
    <published>2017-01-19T11:13:18.000Z</published>
    <updated>2017-03-15T11:36:26.420Z</updated>
    
    <content type="html"><![CDATA[<p>Canvas 星空效果<br>嗯 是的 就是左上方的星空效果<br><a id="more"></a></p>
<h3 id="设计思路"><a href="#设计思路" class="headerlink" title="设计思路"></a>设计思路</h3><p>其实星空在实现上很简单<br>一个星星就是一个星星对象实例<br>有属性x坐标，y坐标，半径，移动速度和透明度<br>有方法生成坐标，绘制星星</p>
<h3 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">        <span class="comment">/*</span></div><div class="line">        * 配置选项</div><div class="line">        * width:画布宽</div><div class="line">        * height:画布高</div><div class="line">        * splitHeight:星星密集分割</div><div class="line">        * stars:星星数量</div><div class="line">        * maxStar:星星最大半径</div><div class="line">        * minStar:星星最小半径</div><div class="line">        * maxSpeed:星星最大移动速度</div><div class="line">        * minSpeed:星星最小移动速度</div><div class="line">        * */</div><div class="line">        <span class="keyword">let</span> SkySetting = &#123;</div><div class="line">                <span class="attr">width</span>:<span class="number">800</span>,</div><div class="line">                <span class="attr">height</span>:<span class="number">300</span>,</div><div class="line">                <span class="attr">splitHeight</span>:<span class="number">200</span>,</div><div class="line">                <span class="attr">stars</span>:<span class="number">400</span>,</div><div class="line">                <span class="attr">maxStar</span>:<span class="number">1.2</span>,</div><div class="line">                <span class="attr">minStar</span>:<span class="number">0.6</span>,</div><div class="line">                <span class="attr">maxSpeed</span>:<span class="number">0.1</span>,</div><div class="line">                <span class="attr">minSpeed</span>:<span class="number">0.02</span>,</div><div class="line">        &#125;,</div><div class="line">            domCanvas = <span class="built_in">document</span>.querySelector(<span class="string">'#Star'</span>),</div><div class="line">            context = domCanvas.getContext(<span class="string">'2d'</span>);</div><div class="line">        <span class="comment">/*</span></div><div class="line">        * 画布实例</div><div class="line">        * */</div><div class="line">        <span class="keyword">let</span> starSky = <span class="function"><span class="keyword">function</span>(<span class="params">width,height,stars</span>)</span>&#123;</div><div class="line">            <span class="keyword">this</span>.width = width;</div><div class="line">            <span class="keyword">this</span>.height = height;</div><div class="line">            <span class="keyword">this</span>.stars = stars;</div><div class="line">            <span class="keyword">this</span>.aStars = [];</div><div class="line">        &#125;</div><div class="line">        starSky.prototype = &#123;</div><div class="line">            <span class="comment">/*</span></div><div class="line">            * 入口</div><div class="line">            * */</div><div class="line">            start:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">                domCanvas.width = <span class="keyword">this</span>.width;</div><div class="line">                domCanvas.height = <span class="keyword">this</span>.height;</div><div class="line">                context.fillStyle = <span class="string">'rgba(0,0,0,1)'</span>;</div><div class="line">                context.fillRect(<span class="number">0</span>,<span class="number">0</span>,<span class="keyword">this</span>.width,<span class="keyword">this</span>.height);</div><div class="line">                <span class="keyword">this</span>.render();</div><div class="line">            &#125;,</div><div class="line">            <span class="comment">/*</span></div><div class="line">            * 重绘</div><div class="line">            * */</div><div class="line">            redraw:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">                context.clearRect(<span class="number">0</span>,<span class="number">0</span>,<span class="keyword">this</span>.width,<span class="keyword">this</span>.height);</div><div class="line">                context.fillStyle = <span class="string">'rgba(0,0,0,1)'</span>;</div><div class="line">                context.fillRect(<span class="number">0</span>,<span class="number">0</span>,<span class="keyword">this</span>.width,<span class="keyword">this</span>.height);</div><div class="line">            &#125;,</div><div class="line">            <span class="comment">/*</span></div><div class="line">            * 新建星星实例</div><div class="line">            * 绘制星星</div><div class="line">            * window.requestAnimationFrame 动画函数</div><div class="line">            * */</div><div class="line">            render:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">                <span class="keyword">this</span>.redraw();</div><div class="line">                <span class="keyword">if</span>(<span class="keyword">this</span>.aStars.length &lt;= <span class="keyword">this</span>.stars)&#123;</div><div class="line">                    <span class="keyword">let</span> star = <span class="keyword">new</span> Star();</div><div class="line">                    <span class="keyword">this</span>.aStars.push(star);</div><div class="line">                &#125;</div><div class="line">                <span class="keyword">this</span>.aStars.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">star</span>)</span>&#123;</div><div class="line">                    star.draw();</div><div class="line">                &#125;)</div><div class="line">                <span class="built_in">window</span>.requestAnimationFrame(<span class="function"><span class="params">()</span>=&gt;</span>&#123;</div><div class="line">                    <span class="keyword">this</span>.render();</div><div class="line">                &#125;);</div><div class="line">            &#125;,</div><div class="line">        &#125;</div><div class="line">        <span class="comment">/*</span></div><div class="line">        * 星星构造器</div><div class="line">        * */</div><div class="line">        <span class="keyword">let</span> Star = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">            <span class="keyword">this</span>.randomPoint();</div><div class="line">        &#125;</div><div class="line">        Star.prototype = &#123;</div><div class="line">            <span class="comment">/*</span></div><div class="line">            * 随机星星数据</div><div class="line">            * */</div><div class="line">            randomPoint:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">                <span class="keyword">let</span> _x = <span class="built_in">Math</span>.random()*SkySetting.width,</div><div class="line">                    _r = SkySetting.minStar + <span class="built_in">Math</span>.random()*(SkySetting.maxStar - SkySetting.minStar),</div><div class="line">                    _ran = <span class="built_in">Math</span>.random()*<span class="number">10</span>,</div><div class="line">                    _rx = <span class="built_in">Math</span>.random()*(SkySetting.maxSpeed-SkySetting.minSpeed) + SkySetting.minSpeed,</div><div class="line">                    _y = _ran &gt; <span class="number">2</span> ? <span class="built_in">Math</span>.random()*SkySetting.splitHeight: <span class="built_in">Math</span>.random()*SkySetting.height,</div><div class="line">                    _alphaMax = <span class="built_in">Math</span>.random()*<span class="number">0.8</span> + <span class="number">0.2</span>,</div><div class="line">                    _alphaMin = <span class="number">0.2</span>,</div><div class="line">                    _alpha = <span class="number">0</span>;</div><div class="line">                <span class="keyword">this</span>.x = _x;</div><div class="line">                <span class="keyword">this</span>.y = _y;</div><div class="line">                <span class="keyword">this</span>.r = _r;</div><div class="line">                <span class="keyword">this</span>.rx = _rx;</div><div class="line">                <span class="keyword">this</span>.alpha = _alpha;</div><div class="line">                <span class="keyword">this</span>.alphaMax = _alphaMax;</div><div class="line">                <span class="keyword">this</span>.alphaMin = _alphaMin;</div><div class="line">                <span class="keyword">this</span>.alphaAction = <span class="literal">true</span>;</div><div class="line">            &#125;,</div><div class="line">            <span class="comment">/*</span></div><div class="line">            * 绘制星星</div><div class="line">            * 星星变化</div><div class="line">            * */</div><div class="line">            draw:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">                <span class="keyword">this</span>.x += <span class="keyword">this</span>.rx;</div><div class="line">                <span class="keyword">if</span>(<span class="keyword">this</span>.x + <span class="keyword">this</span>.r &gt;= SkySetting.width)&#123;</div><div class="line">                    <span class="keyword">this</span>.x = <span class="number">0</span>;</div><div class="line">                &#125;</div><div class="line">                <span class="keyword">if</span>(<span class="keyword">this</span>.alphaAction)&#123;</div><div class="line">                    <span class="keyword">if</span>(<span class="keyword">this</span>.alpha &lt; <span class="keyword">this</span>.alphaMax)&#123;</div><div class="line">                        <span class="keyword">this</span>.alpha += <span class="number">0.05</span>;</div><div class="line">                    &#125;<span class="keyword">else</span>&#123;</div><div class="line">                        <span class="keyword">this</span>.alphaAction = <span class="literal">false</span></div><div class="line">                    &#125;</div><div class="line">                &#125;</div><div class="line">                <span class="keyword">if</span>(!<span class="keyword">this</span>.alphaAction)&#123;</div><div class="line">                    <span class="keyword">if</span>(<span class="keyword">this</span>.alpha &gt; <span class="keyword">this</span>.alphaMin)&#123;</div><div class="line">                        <span class="keyword">this</span>.alpha -= <span class="number">0.02</span>;</div><div class="line">                    &#125;</div><div class="line">                    <span class="keyword">else</span>&#123;</div><div class="line">                        <span class="keyword">this</span>.alphaAction = <span class="literal">true</span>;</div><div class="line">                    &#125;</div><div class="line">                &#125;</div><div class="line">                context.beginPath();</div><div class="line">                context.fillStyle = <span class="string">'rgba(255,255,255,'</span>+<span class="keyword">this</span>.alpha.toString()+<span class="string">')'</span>;</div><div class="line">                context.arc(<span class="keyword">this</span>.x,<span class="keyword">this</span>.y,<span class="keyword">this</span>.r,<span class="number">0</span>,<span class="built_in">Math</span>.PI*<span class="number">2</span>,<span class="literal">true</span>);</div><div class="line">                context.closePath();</div><div class="line">                context.fill();</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="comment">/*</span></div><div class="line">        * 构造星空实例</div><div class="line">        * */</div><div class="line">        <span class="keyword">let</span> sky = <span class="keyword">new</span> starSky(SkySetting.width,SkySetting.height,SkySetting.stars);</div><div class="line">        sky.start();</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;Canvas 星空效果&lt;br&gt;嗯 是的 就是左上方的星空效果&lt;br&gt;
    
    </summary>
    
    
      <category term="canvas" scheme="//blog.fenghou.site/tags/canvas/"/>
    
  </entry>
  
  <entry>
    <title>Canvas--刮刮卡</title>
    <link href="//blog.fenghou.site/2017/01/18/2017-01-18-Canvas%E5%88%AE%E5%88%AE%E5%8D%A1/"/>
    <id>//blog.fenghou.site/2017/01/18/2017-01-18-Canvas刮刮卡/</id>
    <published>2017-01-18T11:12:27.000Z</published>
    <updated>2017-03-15T11:38:58.172Z</updated>
    
    <content type="html"><![CDATA[<p>到年底了，去回顾了下做过的项目<br>发现有很多跟Canvas有关的<br>这里简单记录一点心得<br>方便日后查阅<br><a id="more"></a></p>
<h2 id="一个模拟刮奖的活动"><a href="#一个模拟刮奖的活动" class="headerlink" title="一个模拟刮奖的活动"></a>一个模拟刮奖的活动</h2><h3 id="设计思路"><a href="#设计思路" class="headerlink" title="设计思路"></a>设计思路</h3><p>获奖结果上实现一个遮层<br>手指滑动位置遮层对应位置色值清空<br>判断清空数据达到设定值，清除遮层</p>
<h3 id="必备API"><a href="#必备API" class="headerlink" title="必备API"></a>必备API</h3><p>getContext()<br>getImageData() //获取画布像素数据 每个像素包含RGBA四个值<br>fill() //填充<br>rect() //矩形<br>arc() //圆<br>globalCompositeOperation //设置或返回如何将一个源（新的）图像绘制到目标（已有）的图像上</p>
<h3 id="touch事件"><a href="#touch事件" class="headerlink" title="touch事件"></a>touch事件</h3><p>touchstart<br>touchmove<br>touchend<br>changedTouches:touchlist。<br>对于 touchstart 事件, 这个 TouchList 对象列出在此次事件中新增加的触点<br>对于 touchmove 事件，列出和上一次事件相比较，发生了变化的触点<br>对于 touchend ，列出离开触摸平面的触点（这些触点对应已经不接触触摸平面的手指）</p>
<h3 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">        <span class="keyword">let</span> domCanvas = <span class="built_in">document</span>.querySelector(<span class="string">'#GGL'</span>),</div><div class="line">            context = domCanvas.getContext(<span class="string">'2d'</span>);</div><div class="line">        <span class="comment">/*</span></div><div class="line">        * 构建对象</div><div class="line">        * width</div><div class="line">        * height</div><div class="line">        * filter 取消遮罩百分比</div><div class="line">        * */</div><div class="line">        <span class="keyword">let</span> clipImage = <span class="function"><span class="keyword">function</span>(<span class="params">height,width,filter</span>)</span>&#123;</div><div class="line">            <span class="keyword">this</span>.width = width;</div><div class="line">            <span class="keyword">this</span>.height = height;</div><div class="line">            <span class="keyword">this</span>.filter = filter;</div><div class="line">            domCanvas.width = <span class="keyword">this</span>.width;</div><div class="line">            domCanvas.height = <span class="keyword">this</span>.height;</div><div class="line">        &#125;</div><div class="line">        clipImage.prototype = &#123;</div><div class="line">            <span class="comment">/*</span></div><div class="line">            * 函数入口</div><div class="line">            * 开始监听事件</div><div class="line">            * */</div><div class="line">            start:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">                context.fillStyle = <span class="string">'gray'</span>;</div><div class="line">                context.fillRect(<span class="number">0</span>,<span class="number">0</span>,<span class="keyword">this</span>.width,<span class="keyword">this</span>.height);</div><div class="line">                context.globalCompositeOperation = <span class="string">'destination-out'</span>;</div><div class="line">                <span class="keyword">this</span>.bindEventMove = <span class="keyword">this</span>.eventMove.bind(<span class="keyword">this</span>);</div><div class="line">                <span class="keyword">this</span>.bindEventUp= <span class="keyword">this</span>.eventUp.bind(<span class="keyword">this</span>);</div><div class="line">                domCanvas.addEventListener(<span class="string">'touchstart'</span>,<span class="keyword">this</span>.eventDown)</div><div class="line">                domCanvas.addEventListener(<span class="string">'touchmove'</span>,<span class="keyword">this</span>.bindEventMove)</div><div class="line">                domCanvas.addEventListener(<span class="string">'touchend'</span>,<span class="keyword">this</span>.bindEventUp)</div><div class="line">            &#125;,</div><div class="line">            <span class="attr">eventDown</span>:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">                <span class="built_in">console</span>.log(<span class="string">'Down'</span>)</div><div class="line">            &#125;,</div><div class="line">            <span class="attr">eventMove</span>:<span class="function"><span class="keyword">function</span>(<span class="params">e</span>)</span>&#123;</div><div class="line">                <span class="built_in">console</span>.log(<span class="string">'Move'</span>);</div><div class="line">                <span class="keyword">let</span> target = e.changedTouches[e.changedTouches.length<span class="number">-1</span>];</div><div class="line">                <span class="keyword">this</span>.clearMove(target)</div><div class="line">            &#125;,</div><div class="line">            <span class="attr">eventUp</span>:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">                <span class="built_in">console</span>.log(<span class="string">'Up'</span>);</div><div class="line">                <span class="keyword">this</span>.clearMask();</div><div class="line">            &#125;,</div><div class="line">            <span class="comment">/*</span></div><div class="line">            * 清除划过画布</div><div class="line">            * */</div><div class="line">            clearMove:<span class="function"><span class="keyword">function</span>(<span class="params">target</span>)</span>&#123;</div><div class="line">                <span class="keyword">let</span> nX = target.clientX,</div><div class="line">                    nY = target.clientY;</div><div class="line">                context.beginPath();</div><div class="line">                context.arc(nX,nY,<span class="number">15</span>,<span class="number">0</span>,<span class="built_in">Math</span>.PI * <span class="number">2</span>);</div><div class="line">                context.fill();</div><div class="line">            &#125;,</div><div class="line">            <span class="comment">/*</span></div><div class="line">            * 判断像素点清除数是否到达指定百分比</div><div class="line">            * */</div><div class="line">            clearMask:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">                <span class="keyword">let</span> nNum = <span class="number">0</span>,</div><div class="line">                    aImageData = context.getImageData(<span class="number">0</span>,<span class="number">0</span>,<span class="keyword">this</span>.width,<span class="keyword">this</span>.height).data,</div><div class="line">                    nLength = aImageData.length;</div><div class="line">                aImageData.forEach(<span class="function">(<span class="params">item</span>)=&gt;</span>&#123;</div><div class="line">                    <span class="keyword">if</span>(item == <span class="number">0</span>)&#123;</div><div class="line">                        nNum++;</div><div class="line">                    &#125;</div><div class="line">                &#125;)</div><div class="line">                <span class="keyword">if</span>(nNum &gt;= nLength * <span class="keyword">this</span>.filter)&#123;</div><div class="line">                    <span class="keyword">this</span>.finish();</div><div class="line">                &#125;</div><div class="line">            &#125;,</div><div class="line">            <span class="comment">/*</span></div><div class="line">            * 完成刮奖</div><div class="line">            * */</div><div class="line">            finish:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">                context.beginPath();</div><div class="line">                context.rect(<span class="number">0</span>,<span class="number">0</span>,<span class="keyword">this</span>.width,<span class="keyword">this</span>.height);</div><div class="line">                context.fill();</div><div class="line">                domCanvas.removeEventListener(<span class="string">'touchstart'</span>,<span class="keyword">this</span>.eventDown);</div><div class="line">                domCanvas.removeEventListener(<span class="string">'touchmove'</span>,<span class="keyword">this</span>.bindEventMove);</div><div class="line">                domCanvas.removeEventListener(<span class="string">'touchend'</span>,<span class="keyword">this</span>.bindEventUp);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">let</span> clip = <span class="keyword">new</span> clipImage(<span class="number">400</span>,<span class="number">400</span>,<span class="number">.3</span>);</div><div class="line">        clip.start();</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;到年底了，去回顾了下做过的项目&lt;br&gt;发现有很多跟Canvas有关的&lt;br&gt;这里简单记录一点心得&lt;br&gt;方便日后查阅&lt;br&gt;
    
    </summary>
    
    
      <category term="canvas" scheme="//blog.fenghou.site/tags/canvas/"/>
    
  </entry>
  
  <entry>
    <title>谈谈js的继承</title>
    <link href="//blog.fenghou.site/2017/01/03/2017-01-03-%E8%B0%88%E8%B0%88js%E7%9A%84%E7%BB%A7%E6%89%BF/"/>
    <id>//blog.fenghou.site/2017/01/03/2017-01-03-谈谈js的继承/</id>
    <published>2017-01-03T11:11:44.000Z</published>
    <updated>2017-03-15T11:44:30.709Z</updated>
    
    <content type="html"><![CDATA[<p>继承在JavaScript中不像在别的面向对象语言中那样简单<br>JavaScript使用的是基于对象的继承<br>它可以用来模仿基于类的继承<br><a id="more"></a><br>Es6中，新增了Class和extends关键字来支持类的继承<br>在这里记录各种继承的实现方式</p>
<h3 id="类式继承"><a href="#类式继承" class="headerlink" title="类式继承"></a>类式继承</h3><p>JavaScript对象可以模仿Java中的对象<br>通过函数来声明类<br>用关键字new来创建实例<br>这种方式包括两个步骤<br>1.用一个类的声明定义对象的结构<br>2.实例化该类创建一个新对象<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//类的实例</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params">name</span>)</span>&#123;</div><div class="line">        <span class="keyword">this</span>.name = name;</div><div class="line">&#125;</div><div class="line">Person.prototype.sayName = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.sName);</div><div class="line">&#125;;</div><div class="line"><span class="keyword">var</span> Ls = <span class="keyword">new</span> Person(<span class="string">'Ls'</span>);</div><div class="line">Ls.sayName();</div></pre></td></tr></table></figure></p>
<p>这种类式继承的方式可以分为五种<br>对象冒充，Call，Apply，原型链和混合模式</p>
<h3 id="对象冒充"><a href="#对象冒充" class="headerlink" title="对象冒充"></a>对象冒充</h3><p>构造函数使用 this 关键字给所有属性和方法赋值<br>因为构造函数只是一个函数<br>所以可使Person构造函数成为Author的方法，然后调用它<br>Author就会收到Person的构造函数中定义的属性和方法<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params">name</span>)</span>&#123;</div><div class="line">        <span class="keyword">this</span>.name = name;</div><div class="line">        <span class="keyword">this</span>.sayName=<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">            <span class="built_in">console</span>.log(<span class="keyword">this</span>.name);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">Author</span>(<span class="params">name,book</span>)</span>&#123;</div><div class="line">        <span class="keyword">this</span>.book = book;</div><div class="line">        <span class="keyword">this</span>.Person = Person;</div><div class="line">        <span class="keyword">this</span>.Person(name);</div><div class="line">        <span class="keyword">delete</span> <span class="keyword">this</span>.Person;</div><div class="line">        <span class="keyword">this</span>.sayBook = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">            <span class="built_in">console</span>.log(<span class="keyword">this</span>.book)</div><div class="line">        &#125;</div><div class="line">&#125;</div><div class="line"><span class="keyword">var</span> Ls = <span class="keyword">new</span> Author(<span class="string">'Ls'</span>,<span class="string">'My Book'</span>);</div><div class="line">Ls.sayName();</div><div class="line">Ls.sayBook();</div></pre></td></tr></table></figure></p>
<h3 id="apply-amp-amp-call继承"><a href="#apply-amp-amp-call继承" class="headerlink" title="apply&amp;&amp;call继承"></a>apply&amp;&amp;call继承</h3><p>call和apply方法通过改变函数上下文实现继承<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params">name</span>)</span>&#123;</div><div class="line">        <span class="keyword">this</span>.name = name;</div><div class="line">        <span class="keyword">this</span>.sayName=<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">            <span class="built_in">console</span>.log(<span class="keyword">this</span>.name);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">Author</span>(<span class="params">name,book</span>)</span>&#123;</div><div class="line">        <span class="keyword">this</span>.book = book;</div><div class="line">        Person.call(<span class="keyword">this</span>,name);</div><div class="line">        Person.apply(<span class="keyword">this</span>,[name]);</div><div class="line">        <span class="keyword">this</span>.sayBook = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">            <span class="built_in">console</span>.log(<span class="keyword">this</span>.book)</div><div class="line">        &#125;</div><div class="line">&#125;</div><div class="line"><span class="keyword">var</span> Ls = <span class="keyword">new</span> Author(<span class="string">'Ls'</span>,<span class="string">'My Book'</span>);</div><div class="line">    Ls.sayName();</div><div class="line">    Ls.sayBook();</div></pre></td></tr></table></figure></p>
<h3 id="原型链"><a href="#原型链" class="headerlink" title="原型链"></a>原型链</h3><p>使子类原型对象指向父类的实例以实现继承,即重写类的原型对象<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params"></span>)</span>&#123;</div><div class="line">&#125;</div><div class="line">Person.prototype.sName = <span class="string">''</span>;</div><div class="line">Person.prototype.sayName = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.sName);</div><div class="line">&#125;;</div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">Author</span>(<span class="params">book</span>)</span>&#123;</div><div class="line">    <span class="keyword">this</span>.book = book;</div><div class="line">&#125;</div><div class="line">Author.prototype = <span class="keyword">new</span> Person();</div><div class="line">Author.prototype.sayBook= <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.book);</div><div class="line">&#125;;</div><div class="line"><span class="keyword">var</span> Ls = <span class="keyword">new</span> Author(<span class="string">'My book'</span>);</div><div class="line">Ls.sName = <span class="string">'Ls'</span>;</div><div class="line">Ls.sayName();</div><div class="line">Ls.sayBook();</div></pre></td></tr></table></figure></p>
<p>这种模式无法使用带参数的构造函数，不支持多重继承</p>
<h3 id="混合模式继承"><a href="#混合模式继承" class="headerlink" title="混合模式继承"></a>混合模式继承</h3><p>用对象冒充继承构造函数的属性，用原型链继承 prototype 对象的方法<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params">name</span>)</span>&#123;</div><div class="line">    <span class="keyword">this</span>.name = name;</div><div class="line">&#125;</div><div class="line">Person.prototype.sayName = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.name);</div><div class="line">&#125;;</div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">Author</span>(<span class="params">name,book</span>)</span>&#123;</div><div class="line">    Person.call(<span class="keyword">this</span>,name);</div><div class="line">    <span class="keyword">this</span>.book = book;</div><div class="line">&#125;</div><div class="line">Author.prototype = <span class="keyword">new</span> Person();</div><div class="line">Author.prototype.constructor = Author;</div><div class="line">Author.prototype.sayBook = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.book);</div><div class="line">&#125;</div><div class="line"><span class="keyword">var</span> Ls = <span class="keyword">new</span> Author(<span class="string">'Ls'</span>,<span class="string">'My Book'</span>);</div><div class="line">Ls.sayName();</div><div class="line">Ls.sayBook();</div></pre></td></tr></table></figure></p>
<p>为了简化类的声明，可以把派生子类的整个过程包装在一个名为extend的函数中<br>空函数F，这样可以避免创建Person的新实例,因为它可能会比较庞大<br>增加superclass这个属性弱化Author与Person之间的耦合<br>并且确保constructor属性被正确设置<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">extend</span>(<span class="params">subClass.superClass</span>)</span>&#123;</div><div class="line">    <span class="keyword">var</span> F = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;;</div><div class="line">    F.prototype = superClass.prototype;</div><div class="line">    subClass.prototype = <span class="keyword">new</span> F();</div><div class="line">    subClass.prototype.constructor = subClass;</div><div class="line">    subClass.superclass = superClass.prototype;</div><div class="line">    <span class="keyword">if</span>(subClass.prototype.constructor == <span class="built_in">Object</span>.prototype.constructor)&#123;</div><div class="line">        subClass.prototype.constructor = subClass;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params">name</span>)</span>&#123;</div><div class="line">    <span class="keyword">this</span>.name = name;</div><div class="line">&#125;</div><div class="line">Person.prototype.sayName = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.name);</div><div class="line">&#125;;</div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">Author</span>(<span class="params">name,book</span>)</span>&#123;</div><div class="line">    Author.superclass.constructor.call(<span class="keyword">this</span>,name);</div><div class="line">    <span class="keyword">this</span>.book = book;</div><div class="line">&#125;</div><div class="line">extend(Author,Person)</div><div class="line">Author.prototype.sayBook = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.book);</div><div class="line">&#125;</div><div class="line"><span class="keyword">var</span> Ls = <span class="keyword">new</span> Author(<span class="string">'Ls'</span>,<span class="string">'My Book'</span>);</div><div class="line">Ls.sayName();</div><div class="line">Ls.sayBook();</div></pre></td></tr></table></figure></p>
<p>JavaScript中的类式继承仅仅是对正正基于类的继承的一种模仿</p>
<h3 id="原型式继承"><a href="#原型式继承" class="headerlink" title="原型式继承"></a>原型式继承</h3><p>原型式继承与类式继承截然不同<br>它并不需要用类来定义对象结构，只需要创建一个对象<br>这个对象可以被新的对象重用<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> Person = &#123;</div><div class="line">    <span class="attr">name</span>:<span class="string">'default name'</span>,</div><div class="line">    <span class="attr">sayName</span>:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">        <span class="built_in">console</span>.log(<span class="keyword">this</span>.name);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="keyword">var</span> Author = clone(Person);</div><div class="line">Author.book = <span class="string">'default book'</span>;</div><div class="line">Author.sayBook = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.book);</div><div class="line">&#125;</div><div class="line"><span class="keyword">var</span> Ls = clone(Author);</div><div class="line">Ls.name = <span class="string">'Ls'</span>;</div><div class="line">Ls.book = <span class="string">'My Book'</span>;</div><div class="line">Ls.sayName();</div><div class="line">Ls.sayBook();</div><div class="line"><span class="comment">//clone 通过把F的prototype属性设置为作为参数obj传去的原型对象</span></div><div class="line"><span class="comment">//函数返回的结果是一个以给定对象为原型对象的空对象</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">clone</span>(<span class="params">obj</span>)</span>&#123;</div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">F</span>(<span class="params"></span>)</span>&#123;&#125;</div><div class="line">    F.prototype = obj;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">new</span> F();</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="Es6-extends"><a href="#Es6-extends" class="headerlink" title="Es6 extends"></a>Es6 extends</h3><p>Es6中引入了Class 和extends关键字<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span></span>&#123;</div><div class="line">        <span class="keyword">constructor</span>(name)&#123;</div><div class="line">            <span class="keyword">this</span>.name = name;</div><div class="line">        &#125;</div><div class="line">        sayName()&#123;</div><div class="line">            <span class="built_in">console</span>.log(<span class="keyword">this</span>.name)</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Author</span> <span class="keyword">extends</span> <span class="title">Person</span></span>&#123;</div><div class="line">        <span class="keyword">constructor</span>(name,book)&#123;</div><div class="line">            <span class="keyword">super</span>(name);</div><div class="line">            <span class="keyword">this</span>.book = book;</div><div class="line">        &#125;</div><div class="line">        sayBook()&#123;</div><div class="line">            <span class="built_in">console</span>.log(<span class="keyword">this</span>.book);</div><div class="line">        &#125;</div><div class="line">&#125;</div><div class="line"><span class="keyword">var</span> Ls = <span class="keyword">new</span> Author(<span class="string">'Ls'</span>,<span class="string">'My Book'</span>);</div><div class="line">Ls.sayName();</div><div class="line">Ls.sayBook();</div><div class="line">Ls.__proto__ === Author.prototype; <span class="comment">//true</span></div><div class="line">Author.prototype.__proto__ === Person.prototype; <span class="comment">//true</span></div></pre></td></tr></table></figure></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;继承在JavaScript中不像在别的面向对象语言中那样简单&lt;br&gt;JavaScript使用的是基于对象的继承&lt;br&gt;它可以用来模仿基于类的继承&lt;br&gt;
    
    </summary>
    
    
      <category term="js" scheme="//blog.fenghou.site/tags/js/"/>
    
  </entry>
  
  <entry>
    <title>彻底理解Js中的作用域和上下文</title>
    <link href="//blog.fenghou.site/2016/12/30/2016-12-30-%E5%BD%BB%E5%BA%95%E7%90%86%E8%A7%A3Js%E4%B8%AD%E7%9A%84%E4%BD%9C%E7%94%A8%E5%9F%9F%E5%92%8C%E4%B8%8A%E4%B8%8B%E6%96%87/"/>
    <id>//blog.fenghou.site/2016/12/30/2016-12-30-彻底理解Js中的作用域和上下文/</id>
    <published>2016-12-30T11:11:06.000Z</published>
    <updated>2017-03-15T11:50:09.349Z</updated>
    
    <content type="html"><![CDATA[<p>函数的每次调用都有与之紧密相关的作用域和上下文<br>这俩者是完全不同的<br>作用域(Scope) 是基于函数的<br>作用域涉及到所被调用函数中的变量访问，并且不同的调用场景是不一样的<br>而上下文(Context)是基于对象的<br>上下文始终是this关键字的值，它是拥有(控制)当前所执行代码的对象的引用。<br><a id="more"></a></p>
<h3 id="作用域-Scope"><a href="#作用域-Scope" class="headerlink" title="作用域(Scope)"></a>作用域(Scope)</h3><p>首先只有函数具有作用域<br>也就是说，在一个函数内部声明的变量在函数外部无法访问<br>JavaScript的作用域是词法性质的<br>这这意味着函数运行在定义它的作用域中<br>而不是在调用它的作用域中<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="keyword">var</span> a = <span class="number">10</span>;</div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">bar</span>(<span class="params"></span>)</span>&#123;</div><div class="line">        a *= <span class="number">2</span>;</div><div class="line">        <span class="keyword">return</span> a;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> bar;</div><div class="line">&#125;</div><div class="line"><span class="keyword">var</span> baz = foo();</div><div class="line">baz(); <span class="comment">//20</span></div></pre></td></tr></table></figure></p>
<p>Es6之前 局部变量只能存在于函数体中<br>Es6开始支持let声明变量 局部变量能存在于块级作用域<br>通过var声明的变量会出现变量提升的问题</p>
<blockquote>
<p>变量的 声明周期<br>  声明阶段(Declaration phase)<br>  初始化阶段(Initialization phase)<br>  初始化阶段：variable = undefined<br>  赋值阶段(Assignment phase)<br>  赋值阶段后：variable = ‘value’</p>
</blockquote>
<p>var<br>变量在函数作用域的开始位置就完成了声明阶段(variable)和初始化阶段(var variable)，这两个阶段之间没有任何间隙<br>let<br>变量通过声明阶段(foo)后，会进去暂时性死区，此时变量不可访问，直到初始化阶段(let foo)之后，变量才可以被访问<br>所以变量提升是变量的耦合声明并且在作用域的顶部完成初始化<br>然而let生命周期中将声明和初始化阶段解耦。这一解耦使 let 的变量提升现象消失。</p>
<h3 id="上下文-Context"><a href="#上下文-Context" class="headerlink" title="上下文(Context)"></a>上下文(Context)</h3><p>上下文通常取决于函数是如何被调用的<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//当一个函数作为对象中的一个方法被调用的时候,this就设置为调用该方法的对象</span></div><div class="line"><span class="keyword">var</span> foo = &#123;</div><div class="line">    <span class="attr">bar</span>:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">        <span class="built_in">console</span>.log(<span class="keyword">this</span> === foo)</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line">foo.bar() <span class="comment">// true</span></div><div class="line"><span class="comment">//当使用new操作符创造对象的实例时,函数的作用域内部this的值被设置为新创建的实例</span></div><div class="line"><span class="keyword">let</span> aThis = [];</div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params">x</span>)</span>&#123;</div><div class="line">    <span class="keyword">this</span>.x = x;</div><div class="line">    aThis.push(<span class="keyword">this</span>);</div><div class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>);</div><div class="line">    <span class="comment">//foo&#123;x:1&#125;</span></div><div class="line">    <span class="comment">//foo&#123;x:2&#125;</span></div><div class="line">&#125;</div><div class="line">foo.prototype.baz = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.x);</div><div class="line">    <span class="comment">//1</span></div><div class="line">    <span class="comment">//2</span></div><div class="line">&#125;</div><div class="line"><span class="keyword">new</span> foo(<span class="number">1</span>);</div><div class="line"><span class="keyword">new</span> foo(<span class="number">2</span>);</div><div class="line">aThis.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">item</span>)</span>&#123;</div><div class="line">    item.baz();</div><div class="line">&#125;)</div></pre></td></tr></table></figure></p>
<h3 id="执行环境-execution-context"><a href="#执行环境-execution-context" class="headerlink" title="执行环境(execution context)"></a>执行环境(execution context)</h3><p>执行环境 定义了变量或函数有权访问的数据，决定它们各自的行为<br>Js是单线程的，当JavaScript解释器初始化执行代码时，会默认进入全局执行环境<br>此后函数的每次调用都会创建一个新的执行环境<br>每个函数都有自己的执行环境，当执行流进入一个函数时，函数的环境会被推入一个环境栈中<br>在函数执行完后，栈将其环境弹出，把控制权返回给之前的执行环境。<br>ECMAScript程序中的执行流正是由这个便利的机制控制着<br>执行环境可以分为创建和执行两个阶段。<br>在创建阶段，解析器首先会创建一个变量对象（variable object，也称为活动对象 activation object），<br>它由定义在执行环境中的变量、函数声明、和参数组成。<br>在这个阶段，作用域链会被初始化， this 的值也会被最终确定。<br>在执行阶段，代码被解释执行。</p>
<h3 id="作用域链-scope-chain"><a href="#作用域链-scope-chain" class="headerlink" title="作用域链(scope chain)"></a>作用域链(scope chain)</h3><p>当代码在一个环境中执行时<br>会创建变量对象的一个作用域链<br>作用域链的用途是保证对执行环境有权访问的所有变量和函数的有序访问<br>作用域链包含了在环境栈中的每个执行环境对应的变量对象<br>内部环境可以通过作用域链访问所有的外部环境<br>但是外部环境不能访问内部环境中的任何变量和函数<br>这些环境之间的联系是线性的、有次序的</p>
<h3 id="闭包"><a href="#闭包" class="headerlink" title="闭包"></a>闭包</h3><p>闭包是指有权访问另一函数作用域中的变量的函数<br>在函数内定义一个嵌套的函数时，就构成了一个闭包<br>它允许嵌套函数访问外层函数的变量<br>通过返回嵌套函数，允许你维护对外部函数中局部变量、参数、和内函数声明的访问。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//模块模式最流行的闭包类型之一，它允许你模拟公共的、私有的、和特权成员</span></div><div class="line"><span class="keyword">let</span> Module = (<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="keyword">var</span> privateProperty = <span class="string">'foo'</span>;</div><div class="line">    fucntion privateMethod()&#123;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> &#123;</div><div class="line">        <span class="attr">publicProperty</span>:<span class="string">''</span>,</div><div class="line">        <span class="attr">publicMethod</span>:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">        &#125;,</div><div class="line">        <span class="attr">privilegedMethod</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">            <span class="keyword">return</span> privateMethod(<span class="built_in">arguments</span>);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;)()</div><div class="line"><span class="comment">//另一种类型的闭包被称为 立即执行的函数表达式(IIFE) Es5中</span></div><div class="line">(<span class="function"><span class="keyword">function</span>(<span class="params">window</span>)</span>&#123;</div><div class="line">    <span class="keyword">var</span> foo, bar;</div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">private</span>(<span class="params"></span>)</span>&#123;</div><div class="line">        <span class="comment">// do something</span></div><div class="line">    &#125;</div><div class="line">    <span class="keyword">var</span> Module = &#123;</div><div class="line">        <span class="attr">public</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">            <span class="comment">// do something</span></div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">    <span class="built_in">window</span>.Module = Module;</div><div class="line">&#125;)(<span class="keyword">this</span>);</div><div class="line"><span class="comment">//保护全局命名空间免受变量污染</span></div><div class="line"><span class="keyword">var</span> baz;</div><div class="line">(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="keyword">var</span> foo = <span class="number">10</span>;</div><div class="line">    <span class="keyword">var</span> bar = <span class="number">2</span>;</div><div class="line">    baz = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">        <span class="keyword">return</span> foo * bar;</div><div class="line">    &#125;</div><div class="line">&#125;)()</div><div class="line">baz(); <span class="comment">//20</span></div><div class="line"><span class="comment">//保护私用private变量</span></div></pre></td></tr></table></figure></p>
<h3 id="apply-amp-call-amp-bind"><a href="#apply-amp-call-amp-bind" class="headerlink" title="apply&amp;call&amp;bind"></a>apply&amp;call&amp;bind</h3><p>apply和call内建在所有的函数中(它们是Function对象的原型方法)<br>允许你在自定义上下文中执行函数<br>不同点在于，call函数需要参数列表，而apply 函数需要你提供一个参数数组</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//arguments</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    [].slice.apply(<span class="built_in">arguments</span>);</div><div class="line">    [].sort.apply(<span class="built_in">arguments</span>,<span class="function"><span class="keyword">function</span>(<span class="params">a,b</span>)</span>&#123;</div><div class="line">        <span class="keyword">return</span> a&gt;b;</div><div class="line">    &#125;)</div><div class="line">&#125;</div><div class="line"><span class="comment">//apply在传递参数时会将数组转变成列表集合</span></div><div class="line"><span class="comment">//在一些只能处理列表的方法中可以巧妙地处理</span></div><div class="line"><span class="comment">//求数组最大值</span></div><div class="line"><span class="keyword">let</span> a = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>];</div><div class="line"><span class="built_in">Math</span>.max(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>); <span class="comment">//3</span></div><div class="line"><span class="built_in">Math</span>.max.apply(<span class="keyword">this</span>,a); <span class="comment">//3</span></div><div class="line"><span class="comment">//两个数组合并</span></div><div class="line"><span class="keyword">let</span> a = [<span class="number">1</span>,<span class="number">2</span>],</div><div class="line">    b = [<span class="number">3</span>,<span class="number">4</span>];</div><div class="line"><span class="comment">//a.push(b)</span></div><div class="line"><span class="comment">//a [1,2,[3,4]];</span></div><div class="line">[].push.apply(a,b)</div><div class="line"><span class="comment">//a [1,2,3,4];</span></div></pre></td></tr></table></figure>
<p>在ES5中引入了 Function.prototype.bind 方法，<br>用于控制函数的执行上下文，它会返回一个新的函数，<br>并且这个新函数会被永久的绑定到 bind 方法的第一个参数所指定的对象上，无论该函数被如何使用。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//低版本浏览器，我们可以简单的对它进行实现如下(polyfill)</span></div><div class="line"><span class="keyword">if</span>(!(<span class="string">'bind'</span> <span class="keyword">in</span> <span class="built_in">Function</span>.prototype))&#123;</div><div class="line">    <span class="built_in">Function</span>.prototype.bind = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">        <span class="keyword">var</span> fn = <span class="keyword">this</span>,</div><div class="line">            context = <span class="built_in">arguments</span>[<span class="number">0</span>],</div><div class="line">            args = <span class="built_in">Array</span>.prototype.slice.call(<span class="built_in">arguments</span>, <span class="number">1</span>);</div><div class="line">        <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">            <span class="keyword">return</span> fn.apply(context, args.concat(<span class="built_in">arguments</span>));</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="Es6箭头函数"><a href="#Es6箭头函数" class="headerlink" title="Es6箭头函数"></a>Es6箭头函数</h3><p>S6中的箭头函数可以作为 Function.prototype.bind() 的替代品。<br>和普通函数不同，箭头函数没有它自己的this值，它的 this 值继承自外围作用域。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> Obj = &#123;</div><div class="line">    <span class="attr">baz</span>:..</div><div class="line">    foo:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">        <span class="keyword">let</span> self = <span class="keyword">this</span>;</div><div class="line">        [<span class="number">1</span>,<span class="number">2</span>,<span class="number">4</span>,<span class="number">5</span>].forEach(<span class="function"><span class="keyword">function</span>(<span class="params">item</span>)</span>&#123;</div><div class="line">            self.baz(item);</div><div class="line">        &#125;)</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="comment">//Es5 bind</span></div><div class="line"><span class="keyword">var</span> Obj = &#123;</div><div class="line">    <span class="attr">baz</span>:..</div><div class="line">    foo:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">        [<span class="number">1</span>,<span class="number">2</span>,<span class="number">4</span>,<span class="number">5</span>].forEach(<span class="function"><span class="keyword">function</span>(<span class="params">item</span>)</span>&#123;</div><div class="line">            self.baz(item);</div><div class="line">        &#125;.bind(<span class="keyword">this</span>))</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="comment">//Es6箭头函数</span></div><div class="line"><span class="keyword">var</span> Obj = &#123;</div><div class="line">    <span class="attr">baz</span>:..</div><div class="line">    foo:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">        [<span class="number">1</span>,<span class="number">2</span>,<span class="number">4</span>,<span class="number">5</span>].forEach(<span class="function">(<span class="params">item</span>)=&gt;</span><span class="keyword">this</span>.baz(item))</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;函数的每次调用都有与之紧密相关的作用域和上下文&lt;br&gt;这俩者是完全不同的&lt;br&gt;作用域(Scope) 是基于函数的&lt;br&gt;作用域涉及到所被调用函数中的变量访问，并且不同的调用场景是不一样的&lt;br&gt;而上下文(Context)是基于对象的&lt;br&gt;上下文始终是this关键字的值，它是拥有(控制)当前所执行代码的对象的引用。&lt;br&gt;
    
    </summary>
    
    
      <category term="js" scheme="//blog.fenghou.site/tags/js/"/>
    
  </entry>
  
  <entry>
    <title>ECMA-prototype</title>
    <link href="//blog.fenghou.site/2016/12/28/2016-12-28-ECMA-prototype/"/>
    <id>//blog.fenghou.site/2016/12/28/2016-12-28-ECMA-prototype/</id>
    <published>2016-12-28T11:09:23.000Z</published>
    <updated>2017-03-15T11:52:29.208Z</updated>
    
    <content type="html"><![CDATA[<p>要学好Js，首先必须得先理解原型(prototype)<br>why？<br>js作为面向对象的语言，实现面向对象的机制就是原型！<br><a id="more"></a><br>都说js中一切皆对象,那到底什么是对象呢？</p>
<blockquote>
<p>对象是属性的集合，并有一个原型对象。原型对象可以是空值。<br>  按宿主环境分可以分为<br>  原生对象：由ECMAScript规范定义其语义的对象<br>  内置对象：由ECMAScript实现提供，独立于宿主环境的对象，ECMAScript程序开始执行时就存在(所有内置对象是原生对象)<br>  宿主对象：由宿主环境提供的对象，用于完善ECMAScript执行环境(DOM,BOM)<br>  按功能分可以分为：<br>  普通对象：无原型对象<br>  函数对象：有原型对象(函数对象的一个实例)</p>
</blockquote>
<p>我们这里只关注函数对象<br>那么到底什么是原型呢？</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//凡是通过new Function() 创建的对象都是函数对象</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">Bar</span>(<span class="params"></span>)</span>&#123;&#125;</div><div class="line"><span class="keyword">var</span> foo = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;</div><div class="line"><span class="keyword">var</span> baz = <span class="keyword">new</span> <span class="built_in">Function</span>();</div><div class="line"><span class="comment">//Bar foo baz 都是函数对象</span></div><div class="line"><span class="comment">//原型对象本质是函数对象的一个实例</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">Bar</span>(<span class="params"></span>)</span>&#123;</div><div class="line">&#125;</div><div class="line">Bar.prototype</div><div class="line"><span class="keyword">var</span> temp = <span class="keyword">new</span> Bar();</div><div class="line">Bar.prototype = temp;</div><div class="line"><span class="keyword">var</span> temp = <span class="keyword">new</span> <span class="built_in">Function</span>();</div><div class="line"><span class="built_in">Function</span>.prototype = temp</div><div class="line"><span class="comment">//构造器：创建和初始化对象的函数对象(在原型对象prototype中,prototype.constructor)</span></div><div class="line"><span class="comment">//原型对象prototype中都有个预定义的constructor属性，用来引用它的函数对象</span></div><div class="line"><span class="comment">//每个由构造器创建的对象拥有一个执行构造器prototype的属性值的隐式引用</span></div><div class="line"><span class="comment">//这个引用称之为原型</span></div><div class="line"><span class="comment">//每个原型可以拥有指向自己原型的隐式引用(原型的原型),就是所谓的原型链</span></div><div class="line"><span class="comment">//每个对象都有一个__proto__属性来实现对原型的隐式引用</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params"></span>)</span>&#123;&#125;</div><div class="line">Person.prototype = &#123;</div><div class="line">    <span class="attr">name</span>:<span class="string">'Louis'</span>,</div><div class="line">    <span class="attr">age</span>:<span class="string">'24'</span></div><div class="line">&#125;</div><div class="line"><span class="keyword">var</span> person = <span class="keyword">new</span> Person();</div><div class="line">person.__proto__ = Person.prototype</div><div class="line">Person.prototype.__proto__ = <span class="built_in">Object</span>.prototype</div><div class="line"><span class="built_in">Object</span>.prototype.__proto__ = <span class="literal">null</span></div><div class="line"><span class="comment">//person对象由构造器Person创建</span></div><div class="line"><span class="comment">//所以person对Person.prototype有隐式引用(__proto__)</span></div><div class="line"><span class="comment">//Person对象又是由构造器Object创建</span></div><div class="line"><span class="comment">//所以Person对Object.prototype有隐式引用(__proto__)</span></div></pre></td></tr></table></figure>
<p><img src="/assets/blogImg/prototype.png" alt="原型"></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;要学好Js，首先必须得先理解原型(prototype)&lt;br&gt;why？&lt;br&gt;js作为面向对象的语言，实现面向对象的机制就是原型！&lt;br&gt;
    
    </summary>
    
    
      <category term="js" scheme="//blog.fenghou.site/tags/js/"/>
    
  </entry>
  
  <entry>
    <title>你真的学好Js了吗</title>
    <link href="//blog.fenghou.site/2016/12/27/2016-12-27-%E4%BD%A0%E7%9C%9F%E7%9A%84%E5%AD%A6%E5%A5%BDJs/"/>
    <id>//blog.fenghou.site/2016/12/27/2016-12-27-你真的学好Js/</id>
    <published>2016-12-27T11:08:58.000Z</published>
    <updated>2017-03-15T11:58:07.909Z</updated>
    
    <content type="html"><![CDATA[<p>在我看来前端(Js)就好比是个剑客江湖<br>江湖中有人练react宝典，有人练vue神功<br>有人锻造webpack利剑<br>…<br><a id="more"></a><br>而Js就是这些的基础心法，决定这些宝典,神功最后在你手上的杀伤力<br>那么作为最基础的心法，你真的参透的了吗？</p>
<blockquote>
<p>这里简单的记录些Js的一些特点</p>
</blockquote>
<h3 id="面向对象"><a href="#面向对象" class="headerlink" title="面向对象"></a>面向对象</h3><p>什么是面向对象</p>
<blockquote>
<p>一切事物皆对象<br>对象具有封装和继承特性<br>对象与对象之间使用消息通信，各自存在信息隐藏</p>
</blockquote>
<p>众所周知Java采用面向对象思想构造其语言，它实现了类、继承、多态、接口等机制。<br>但是这些机制，只是实现面向对象编程的一种方式<br>实际上，Js是通过原型的方式来实现面向对象编程的<br>Js中的对象是依靠构造器(constructor)利用原型(prototype)构造出来的</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//对象的声明</span></div><div class="line"><span class="comment">//字面式对象声明</span></div><div class="line"><span class="keyword">var</span> person = &#123;</div><div class="line">    <span class="attr">name</span>:<span class="string">'Louis'</span>,</div><div class="line">    <span class="attr">age</span>:<span class="string">'24'</span></div><div class="line">&#125;</div><div class="line"><span class="comment">//使用函数构造器构造对象</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params"></span>)</span>&#123;</div><div class="line">&#125;</div><div class="line">Person.prototype = &#123;</div><div class="line">    <span class="attr">name</span>:<span class="string">'Louis'</span>,</div><div class="line">    <span class="attr">age</span>:<span class="string">'24'</span></div><div class="line">&#125;</div><div class="line"><span class="keyword">var</span> person = <span class="keyword">new</span> Person();</div><div class="line"><span class="comment">//这里的new关键字跟java中 的new毫无关系</span></div><div class="line"><span class="comment">//只是借用了它的关键字new</span></div><div class="line"><span class="comment">//用来表示调用构造器创建对象</span></div></pre></td></tr></table></figure>
<h3 id="弱类型语言"><a href="#弱类型语言" class="headerlink" title="弱类型语言"></a>弱类型语言</h3><p>在Js中，定义变量不必声明其类型。但这不意味着变量没有类型。<br>原始类型：布尔型、数值型、字符串类型<br>引用类型：对象类型(数组是一种特殊的对象)、函数类型<br>其他类型：空类型和未定义类型<br>js中的变量可以根据所附的值改变类型<br>原始类型按值传送，在栈内存中存的是变量的值<br>引用类型则按引用传送，在栈内存中存的是 引用对象在堆内存中的地址<br>所以这里涉及到引用类型深拷贝和浅拷贝的问题</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//浅拷贝 把父对象的属性全部拷贝给子对象</span></div><div class="line"><span class="comment">//如果父元素的属性对应的值是引用类型，那子对象对应的属性的值还是引用类型的内存地址</span></div><div class="line"><span class="comment">//这个时候就需要深拷贝</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">deepCopy</span>(<span class="params">pre</span>)</span>&#123;</div><div class="line">        <span class="keyword">var</span> ch = pre.constructor === <span class="built_in">Array</span> ? [] : &#123;&#125;;</div><div class="line">        <span class="keyword">if</span>(<span class="keyword">typeof</span> pre !== <span class="string">'object'</span>)&#123;</div><div class="line">            ch = pre;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(<span class="built_in">window</span>.JSON)&#123;</div><div class="line">            ch = <span class="built_in">JSON</span>.parse(<span class="built_in">JSON</span>.stringify(pre))</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">else</span>&#123;</div><div class="line">            <span class="keyword">for</span>(<span class="keyword">var</span> i <span class="keyword">in</span> pre)&#123;</div><div class="line">                ch[i] = <span class="keyword">typeof</span> pre[i] === <span class="string">'object'</span> ?</div><div class="line">                (pre[i].constructor === <span class="built_in">Array</span> ? pre[i].slice() : deepCopy(pre[i]))</div><div class="line">                : pre[i]</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> ch;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="函数是一等对象"><a href="#函数是一等对象" class="headerlink" title="函数是一等对象"></a>函数是一等对象</h3><p>在JavaScript中，函数是一等对象<br>可以存储在变量中<br>可以作为参数传给其他函数<br>可以作为返回值从其他函数传出<br>还可以在运行时进行构造<br>可以用function(){…}这样的语法创建匿名函数</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="keyword">var</span> foo = <span class="number">20</span>;</div><div class="line">    <span class="keyword">var</span> bar = <span class="number">2</span>;</div><div class="line">    alert(foo*bar);</div><div class="line">&#125;)()</div></pre></td></tr></table></figure>
<p>这个函数在定义后便会立即执行<br>匿名函数可以用来创建闭包<br>闭包是一个受到保护的变量空间<br>由内嵌函数生成</p>
<h3 id="对象的易变性"><a href="#对象的易变性" class="headerlink" title="对象的易变性"></a>对象的易变性</h3><p>JavaScript中,一切都是对象<br>除了三种原始类型(布尔型、数值型、字符串类型)<br>即便是这几种类型在必要时候也会被自动封装成对象<br>而且所有对象都是易变的(mutable)</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//为函数添加属性</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">dispalyError</span>(<span class="params">message</span>)</span>&#123;</div><div class="line">    dispalyError.numTimesExecuted++;</div><div class="line">    alert(message);</div><div class="line">&#125;</div><div class="line">dispalyError.numTimesExecuted = <span class="number">0</span>;</div><div class="line"><span class="comment">//对定义的类和实例化的对象进行修改</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params">name,age</span>)</span>&#123;</div><div class="line">    <span class="keyword">this</span>.name = name;</div><div class="line">    <span class="keyword">this</span>.age = age;</div><div class="line">&#125;</div><div class="line">Person.prototype = &#123;</div><div class="line">    <span class="attr">getName</span>:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.name;</div><div class="line">    &#125;,</div><div class="line">    <span class="attr">getAge</span>:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.age;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="keyword">var</span> alice = <span class="keyword">new</span> Person(<span class="string">'Alice'</span>,<span class="number">39</span>);</div><div class="line"><span class="keyword">var</span> bill = <span class="keyword">new</span> Person(<span class="string">'Bill'</span>,<span class="number">20</span>);</div><div class="line">Person.prototype.getGreeting = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="keyword">return</span> <span class="string">'Hi '</span>+ <span class="keyword">this</span>.getName()+<span class="string">'!'</span>;</div><div class="line">&#125;</div><div class="line">alice.displayGreeting = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    alert(<span class="keyword">this</span>.getGreeting);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="继承"><a href="#继承" class="headerlink" title="继承"></a>继承</h3><p>继承在JavaScript中不像在别的面向对象语言中那样简单<br>JavaScript使用的是基于对象的继承<br>它也可以用来模仿基于类的继承<br>Es6中新增了extends实现继承<br>后面会有文章相信讲讲继承</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;在我看来前端(Js)就好比是个剑客江湖&lt;br&gt;江湖中有人练react宝典，有人练vue神功&lt;br&gt;有人锻造webpack利剑&lt;br&gt;…&lt;br&gt;
    
    </summary>
    
    
      <category term="js" scheme="//blog.fenghou.site/tags/js/"/>
    
  </entry>
  
  <entry>
    <title>从实时聊天谈谈通信协议</title>
    <link href="//blog.fenghou.site/2016/12/26/2016-12-26-%E5%AE%9E%E6%97%B6%E8%81%8A%E5%A4%A9%E8%B0%88%E8%B0%88%E9%80%9A%E4%BF%A1%E5%8D%8F%E8%AE%AE/"/>
    <id>//blog.fenghou.site/2016/12/26/2016-12-26-实时聊天谈谈通信协议/</id>
    <published>2016-12-26T11:08:20.000Z</published>
    <updated>2017-03-15T12:02:03.382Z</updated>
    
    <content type="html"><![CDATA[<p>作为前端开发人员<br>了解前后端通信协议还是很必须的<br>尤其是在用Node写服务端的时候<br>对于请求的响应处理和返回有很大的帮助<br><a id="more"></a><br>客户端与服务端的通信协议有HTTP(HTTPS)协议和WebSocket协议<br>HTTP协议是无状态的，服务端进行处理返回response后很难主动向客户端发送数据<br>WebSocket协议实现了客户端与服务端的全双工通信<br>扩展了客户端与服务端的通信功能<br>使服务端也能主动向客户端发送数据<br>在WebSocket协议提出之前<br>要实现即时通信、实时数据这样的功能，经常会使用轮询(polling)和Comet技术</p>
<p>轮询是最原始的实现实时Web应用的解决方案。<br>轮询技术要求客户端以设定的时间间隔周期性地向服务端发送请求，频繁地查询是否有新的数据改动。<br>明显地，这种方法会导致过多不必要的请求，浪费流量和服务器资源</p>
<p>Comet技术又可以分为长轮询和流技术。<br>长轮询改进了上述的轮询技术，减小了无用的请求。<br>它会为某些数据设定过期时间，当数据过期后才会向服务端发送请求；<br>这种机制适合数据的改动不是特别频繁的情况。<br>流技术通常是指客户端使用一个隐藏的窗口与服务端建立一个HTTP长连接，<br>服务端会不断更新连接状态以保持HTTP长连接存活；<br>这样的话，服务端就可以通过这条长连接主动将数据发送给客户端；<br>流技术在大并发环境下，可能会考验到服务端的性能。</p>
<p>WebSocket，真正实现了Web的实时通信</p>
<h3 id="Http协议"><a href="#Http协议" class="headerlink" title="Http协议"></a>Http协议</h3><p>HTTP(Hypertext Transfer Protocol 超文本传输协议)是一个基于请求与响应模式的、无状态的、应用层的协议<br>HTTP限制每次连接只处理一个请求。服务器处理完客户的请求，并收到客户的应答后，即断开连接<br>HTTP协议是无状态协议。无状态是指协议对于事务处理没有记忆能力。<br>缺少状态意味着如果后续处理需要前面的信息，则它必须重传，<br>这样可能导致每次连接传送的数据量增大。<br>另一方面，在服务器不需要先前信息时它的应答就较快。</p>
<blockquote>
<p>HTTP的常用请求方法<br>  GET 请求获取Request-URI所标识的资源<br>  POST 在Request-URI所标识的资源后附加新的数据<br>  HEAD 请求获取由Request-URI所标识的资源的响应消息报头<br>  请求和响应都包含请求头或响应头header和可选的请求体或响应体Body(自由的文本)<br>  只有POST请求包含一个Body<br>  Content-type常用的MiME类型<br>  application/x-wwwform-urlencoded 经过编码的键值对请求字符串(Body)，web服务器需要解码字符串获得参数<br>  text/xml,application/xml Body是XML文档<br>  text/plain 普通文本<br>  text/html, text/xhtml Body是(X)HTML内容，web服务器端发送的标准web页面或内容片段<br>  text/javascript Body是一段JavaScript代码<br>  image/png, image/jpeg, image/gif：Body是二进制图像</p>
</blockquote>
<h3 id="HTTPS协议"><a href="#HTTPS协议" class="headerlink" title="HTTPS协议"></a>HTTPS协议</h3><p>HTTPS(Secure Hypertext Transfer Protocol 安全超文本传输协议)<br>是一个安全通信通道，它基于HTTP开发，用于在客户计算机和服务器之间交换信息。<br>它使用安全套接字层(SSL)进行信息交换，简单来说它是HTTP的安全版。<br>HTTP协议是不安全的，可以轻松对窃听你跟 Web 服务器之间的数据传输<br>在很多情况下，客户和服务器之间传输的是敏感信息，需要防止未经授权的访问</p>
<p>HTTPS协议在TCP协议上加了层SSL协议</p>
<blockquote>
<p>网络七层协议<br>  应用层 Http Https<br>  表示层 SSL TLS<br>  会话层<br>  传输层 TCP<br>  网络层 IP<br>  数据链路层<br>  物理层</p>
</blockquote>
<p>SSL 包含如下动作：<br>1.验证服务器端<br>2.允许客户端和服务器端选择加密算法和密码，确保双方都支持<br>3.验证客户端(可选)<br>4.使用公钥加密技术来生成共享加密数据<br>5.创建一个加密的 SSL 连接<br>6.基于该 SSL 连接传递 HTTP 请求</p>
<h3 id="TCP协议"><a href="#TCP协议" class="headerlink" title="TCP协议"></a>TCP协议</h3><p>TCP(Transmission Control Protocol 传输控制协议)是一种面向连接的、可靠的、基于字节流的传输层通信协议<br>连接时三次握手<br>第一次Client端发送SYN报文请求连接<br>第二次Server端接受连接后回复ACK报文，并且为这次连接分配资源<br>第三次Client端接收ACK报文后向Server端发送ACK报文，并分配资源<br>TCP连接建立</p>
<p>断开时四次握手<br>第一次Client发起中断连接，发送FIN报文<br>第二次Server端接到FIN报文后，发送ACK报文，(可能还有数据没有传输完)，Client进入FIN_WAIT状态<br>第三次Server端确定数据已经发送完成，则向Client端发送FIN报文，准备好关闭连接<br>第四次Client端接收FIN报文,知道可以关闭连接，但不相信网络,怕Server端不知道要关闭，发送ACK报文，并进入TIME_WAIT状态<br>Server端收到ACK报文后断开连接<br>Client端等待了一定时间(依赖实现方法)后，没有收到Server回复，表示Server端已正常关闭，Client端也关闭链接<br>TCP连接关闭</p>
<h3 id="AJAX"><a href="#AJAX" class="headerlink" title="AJAX"></a>AJAX</h3><p>AJAX (Asynchronous Javascript And XML 异步JavaScript和XML)，是指一种创建交互式网页应用的网页开发技术。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/*</span></div><div class="line">* open(method,url,async) 规定请求的类型、URL 以及是否异步处理请求</div><div class="line">* method：请求的类型；GET 或 POST</div><div class="line">* url：文件在服务器上的位置</div><div class="line">* async：true（异步）或 false（同步）</div><div class="line">*</div><div class="line">* send(string) 将请求发送到服务器</div><div class="line">* string：仅用于 POST 请求</div><div class="line">*</div><div class="line">* setRequestHeader(header,value) 向请求添加 HTTP 头</div><div class="line">* header: 规定头的名称</div><div class="line">* value: 规定头的值</div><div class="line">*</div><div class="line">* responseText	获得字符串形式的响应数据。</div><div class="line">* responseXML	获得XML形式的响应数据。</div><div class="line">*</div><div class="line">* onreadystatechange 存储函数（或函数名），每当 readyState 属性改变时，就会调用该函数</div><div class="line">*</div><div class="line">* readyState 存有 XMLHttpRequest 的状态 从 0 到 4 发生变化</div><div class="line">* 0: 请求未初始化</div><div class="line">* 1: 服务器连接已建立</div><div class="line">* 2: 请求已接收</div><div class="line">* 3: 请求处理中</div><div class="line">* 4: 请求已完成，且响应已就绪</div><div class="line">*</div><div class="line">* status</div><div class="line">* 200: "OK"</div><div class="line">* 404: 未找到页面</div><div class="line">* */</div><div class="line"><span class="keyword">var</span> xmlhttp = <span class="keyword">new</span> XMLHttpRequest();</div><div class="line">xmlhttp.open(<span class="string">'POST'</span>,url,<span class="literal">true</span>);</div><div class="line">xmlhttp.setRequestHeader(<span class="string">'Content-type'</span>,<span class="string">'application/x-www-form-urlencoded'</span>);</div><div class="line">xmlhttp.send(<span class="string">'page=2&amp;size=10'</span>);</div><div class="line">xmlhttp.onreadystatechange = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="keyword">if</span>(xmlhttp.readystate == <span class="number">4</span>)&#123;</div><div class="line">        <span class="keyword">if</span>(xmlhttp.status == <span class="number">200</span>)&#123;</div><div class="line">            <span class="built_in">console</span>.log(xmlhttp.responseText);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">else</span>&#123;</div><div class="line">            <span class="comment">//异常</span></div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="websocket"><a href="#websocket" class="headerlink" title="websocket"></a>websocket</h3><p>websocket协议本质上是一个基于TCP的协议<br>是先通过HTTP/HTTPS协议发起一条特殊的HTTP请求进行握手后创建一个用于交换数据的TCP连接<br>此后服务端与客户端通过此TCP连接进行实时通信</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//客户端</span></div><div class="line"><span class="keyword">var</span> ws = <span class="keyword">new</span> WebSocket(<span class="string">'ws://localhost:8181/'</span>);</div><div class="line"><span class="comment">//连接发生错误的回调方法</span></div><div class="line">ws.onerror = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">&#125;</div><div class="line"><span class="comment">//websocket 在任何时候都会处于下面4种状态中的其中一种</span></div><div class="line"><span class="comment">//CONNECTING (0) 表示还没建立连接</span></div><div class="line"><span class="comment">//OPEN (1)       已经建立连接，可以进行通讯</span></div><div class="line"><span class="comment">//CLOSING (2)    通过关闭握手，正在关闭连接</span></div><div class="line"><span class="comment">//CLOSED (3)     连接已经关闭或无法打开</span></div><div class="line"><span class="comment">//WebSocket.OPEN = 1;</span></div><div class="line"><span class="comment">//连接成功建立的回调方法</span></div><div class="line">ws.onopen = <span class="function"><span class="keyword">function</span>(<span class="params">e</span>)</span>&#123;</div><div class="line">    <span class="keyword">if</span>(ws.readyState === <span class="number">1</span>)&#123;</div><div class="line">        wsSend(<span class="string">'msg'</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="comment">//接收到消息的回调方法</span></div><div class="line">ws.onmessage = <span class="function"><span class="keyword">function</span>(<span class="params">e</span>)</span>&#123;</div><div class="line">    <span class="comment">//e.data</span></div><div class="line">&#125;</div><div class="line"><span class="comment">//连接关闭的回调方法</span></div><div class="line">ws.onclose = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">wsSend</span>(<span class="params">rs</span>)</span>&#123;</div><div class="line">    ws.send(rs);</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">wsEnd</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    ws.close();</div><div class="line">&#125;</div><div class="line"><span class="comment">//服务端(Node)</span></div><div class="line"><span class="keyword">var</span> WebSocketServer = <span class="built_in">require</span>(<span class="string">'ws'</span>).Server,</div><div class="line">    ws = <span class="keyword">new</span> WebSocketServer(&#123; <span class="attr">port</span>: <span class="number">8181</span> &#125;),</div><div class="line">    clients = [],</div><div class="line">    clientNum = <span class="number">0</span>;</div><div class="line">ws.on(<span class="string">'connection'</span>,<span class="function"><span class="keyword">function</span>(<span class="params">ws</span>)</span>&#123;</div><div class="line">    clientNum ++;</div><div class="line">    clients.push(&#123;<span class="string">'ws'</span>:ws&#125;);</div><div class="line">    ws.on(<span class="string">'message'</span>,<span class="function"><span class="keyword">function</span>(<span class="params">rs</span>)</span>&#123;</div><div class="line">        wsSend(rs);</div><div class="line">    &#125;)</div><div class="line">&#125;)</div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">wsSend</span>(<span class="params">rs</span>)</span>&#123;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">var</span> i =<span class="number">0</span>;i&lt;clients.length;i++)&#123;</div><div class="line">        <span class="keyword">var</span> clientSocket = clients[i].ws;</div><div class="line">        <span class="keyword">if</span> (clientSocket.readyState === <span class="number">1</span>) &#123;</div><div class="line">            clientSocket.send(<span class="built_in">JSON</span>.stringify(rs));</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;作为前端开发人员&lt;br&gt;了解前后端通信协议还是很必须的&lt;br&gt;尤其是在用Node写服务端的时候&lt;br&gt;对于请求的响应处理和返回有很大的帮助&lt;br&gt;
    
    </summary>
    
    
      <category term="node" scheme="//blog.fenghou.site/tags/node/"/>
    
      <category term="http" scheme="//blog.fenghou.site/tags/http/"/>
    
      <category term="websocket" scheme="//blog.fenghou.site/tags/websocket/"/>
    
  </entry>
  
  <entry>
    <title>Git自动化部署</title>
    <link href="//blog.fenghou.site/2016/12/22/2016-12-22-git%E8%87%AA%E5%8A%A8%E5%8C%96%E9%83%A8%E7%BD%B2/"/>
    <id>//blog.fenghou.site/2016/12/22/2016-12-22-git自动化部署/</id>
    <published>2016-12-22T11:07:31.000Z</published>
    <updated>2017-03-15T12:05:00.350Z</updated>
    
    <content type="html"><![CDATA[<p>每次更新完博客,得先push到github上<br>然后在服务器上把代码pull下来部署<br><a id="more"></a></p>
<p>一开始 忍了<br>后来 够了</p>
<p>整理一下<br>需要的是本地push成功后服务器上能自动执行pull命令<br>那么问题就变成了如何响应每次的push操作?</p>
<h3 id="WebHooks"><a href="#WebHooks" class="headerlink" title="WebHooks"></a>WebHooks</h3><p>Webhook就是用户通过自定义回调函数的方式来改变Web应用的一种行为，<br>这些回调函数可以由不是该Web应用官方的第三方用户或者开发人员来维护，修改。<br>通过Webhook，你可以自定义一些行为通知到指定的URL去。</p>
<p>那么每次push时候接受到请求，然后执行pull脚本，问题就解决了</p>
<h3 id="github配置"><a href="#github配置" class="headerlink" title="github配置"></a>github配置</h3><p>github 支持webhook<br>在github项目中选择setting<br>webhooks<br>Payload URL 请求地址<br>Content type 请求类型<br>Secret 密文(请求之后用作校验)</p>
<h3 id="请求处理"><a href="#请求处理" class="headerlink" title="请求处理"></a>请求处理</h3><p>通过node接受请求作出响应</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>)</div><div class="line"><span class="keyword">var</span> createHandler = <span class="built_in">require</span>(<span class="string">'github-webhook-handler'</span>)</div><div class="line"><span class="keyword">var</span> handler = createHandler(&#123; <span class="attr">path</span>: <span class="string">'/deploy'</span>, <span class="attr">secret</span>: <span class="string">''</span> &#125;)</div><div class="line">http.createServer(<span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</div><div class="line">    handler(req, res, <span class="function"><span class="keyword">function</span> (<span class="params">err</span>) </span>&#123;</div><div class="line">        res.statusCode = <span class="number">404</span></div><div class="line">        res.end(<span class="string">'no such location'</span>)</div><div class="line">    &#125;)</div><div class="line">&#125;).listen(<span class="number">8989</span>)</div><div class="line">handler.on(<span class="string">'error'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">err</span>) </span>&#123;</div><div class="line">    <span class="built_in">console</span>.error(<span class="string">'Error:'</span>, err.message)</div><div class="line">&#125;)</div><div class="line">handler.on(<span class="string">'push'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">event</span>) </span>&#123;</div><div class="line">    <span class="comment">// 调用pull脚本</span></div><div class="line">    process.exec(<span class="string">'git pull origin master'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">error, stdout, stderr</span>) </span>&#123;</div><div class="line">            <span class="keyword">if</span> (error !== <span class="literal">null</span>) &#123;</div><div class="line">                <span class="built_in">console</span>.log(<span class="string">'exec error: '</span> + error);</div><div class="line">            &#125;</div><div class="line">    &#125;);</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<p>这个时候每次push的时候，会发送一个请求到 url:8989/deylop<br>通过node 服务会作出相应操作</p>
<h3 id="服务器部署"><a href="#服务器部署" class="headerlink" title="服务器部署"></a>服务器部署</h3><p>nginx 方向代理<br>将8989 代理到80端口</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">server &#123;</div><div class="line">       listen <span class="number">80</span>;</div><div class="line">       server_name <span class="string">''</span>;</div><div class="line">       location /deploy &#123;</div><div class="line">               proxy_pass http:<span class="comment">//localhost:8989;</span></div><div class="line">       &#125;</div><div class="line">   &#125;</div></pre></td></tr></table></figure>
<p>通过forever 启动node 服务</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;每次更新完博客,得先push到github上&lt;br&gt;然后在服务器上把代码pull下来部署&lt;br&gt;
    
    </summary>
    
    
      <category term="node" scheme="//blog.fenghou.site/tags/node/"/>
    
      <category term="git" scheme="//blog.fenghou.site/tags/git/"/>
    
  </entry>
  
  <entry>
    <title>1px != 1px -- 移动端适配浅析</title>
    <link href="//blog.fenghou.site/2016/12/19/2016-12-19-%E7%A7%BB%E5%8A%A8%E7%AB%AF%E9%80%82%E9%85%8D/"/>
    <id>//blog.fenghou.site/2016/12/19/2016-12-19-移动端适配/</id>
    <published>2016-12-19T11:06:45.000Z</published>
    <updated>2017-07-12T10:23:51.284Z</updated>
    
    <content type="html"><![CDATA[<p><img src="/assets/blogImg/rem-dpr.png" alt="px"><br><a id="more"></a></p>
<p>css中我们一般使用px作为单位<br>在pc上css中的1个像素往往对应着电脑屏幕中的1个物理像素<br>这可能会给我们造成一个错觉<br>css中的像素等于设备的物理像素<br>但实际情况却并非如此<br>css中的像素只是一个抽象的单位<br>在不同的设备或不同的环境中<br>css中的1px所代表的设备物理像素是不同的</p>
<p>典型的就是retina屏</p>
<p>首先我们先了解几个概念</p>
<h3 id="viewport"><a href="#viewport" class="headerlink" title="viewport"></a>viewport</h3><p>viewport 是用户网页的可视区域<br>pc中就是屏幕宽度<br>移动设备中viewport(这个虚拟窗口)比屏幕宽 一般为980</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">&lt;meta name=<span class="string">"viewport"</span> content=<span class="string">"width=device-width, initial-scale=1.0"</span>&gt;</div><div class="line">移动端布局viewport的宽度设为理想宽度</div><div class="line">layout viewport 默认的viewport 比屏幕宽 <span class="built_in">document</span>.documentElement.clientWidth</div><div class="line">visual viewport  浏览器可视区域的大小 <span class="built_in">window</span>.innerWidth</div><div class="line">ideal viewport 最适合移动设备的viewport</div><div class="line">width：控制 viewport 的大小，可以指定的一个值，如果 <span class="number">600</span>，或者特殊的值，如 device-width 为设备的宽度（单位为缩放为 <span class="number">100</span>% 时的 CSS 的像素）。</div><div class="line">height：和 width 相对应，指定高度。</div><div class="line">initial-scale：初始缩放比例，也即是当页面第一次 load 的时候缩放比例。</div><div class="line">maximum-scale：允许用户缩放到的最大比例。</div><div class="line">minimum-scale：允许用户缩放到的最小比例。</div><div class="line">user-scalable：用户是否可以手动缩放。</div></pre></td></tr></table></figure>
<h3 id="物理像素-physical-pixel"><a href="#物理像素-physical-pixel" class="headerlink" title="物理像素(physical pixel)"></a>物理像素(physical pixel)</h3><p>一个物理像素是显示器(手机屏幕)上最小的物理显示单元<br>在操作系统的调度下<br>每一个设备像素都有自己的颜色值和亮度值。</p>
<h3 id="设备独立像素-density-independent-pixel"><a href="#设备独立像素-density-independent-pixel" class="headerlink" title="设备独立像素(density-independent pixel)"></a>设备独立像素(density-independent pixel)</h3><p>设备独立像素(也叫密度无关像素)<br>可以认为是计算机坐标系统中得一个点<br>这个点代表一个可以由程序使用的虚拟像素(比如: css像素)<br>简单点就是屏幕宽高</p>
<h3 id="设备像素比-device-pixel-ratio"><a href="#设备像素比-device-pixel-ratio" class="headerlink" title="设备像素比(device pixel ratio)"></a>设备像素比(device pixel ratio)</h3><p>设备像素比 ＝ 物理像素 / 设备独立像素<br>5,6的dpr=2，1个css像素等于2个物理像素<br>6p的dpr=3,1个css像素等于3个物理像素</p>
<p>那首先我们在移动端布局，viewport肯定不能是默认的值<br>最终viewport宽度等于应该等于设备的宽度<br>我们的布局视图应该是 按照物理像素来布局<br>设备独立像素可获得<br>设备像素比 window.devicePixelRatio<br>现在假设 在iphone6上布局</p>
<p>此时dpr = 2,<br>dip = 375<br>物理像素应该是 dpr * dip = 750<br>div{<br>border-top:1px solid #000;<br>}<br>现在在页面上要实现一个1px的上边框<br>由于移动端布局viewport缩成设备宽度<br>而分辨率没有变<br>所以这时的1px会有2px的效果</p>
<p>这个时候可以手动将viewport 宽度设成物理像素的宽度，然后将整个页面缩小 dpr 倍</p>
<p>1px 的问题解决了，那如何解决在不同手机显示设计稿中的一个100x100的div<br>设计稿 750<br>其中div 100x100<br>750的设计稿对应的是iPhone6<br>结合上面viewport的缩放<br>div{<br>width:100px;<br>height:100px;<br>}<br>在6上跟设计稿是完全相同的<br>而在5(640)上会变大</p>
<p>这个时候可以通过rem在不同设备上动态计算出比例值</p>
<p>假设在750设计稿中 1rem = 100px<br>那么在640设计稿中 1rem = 640/750*100px<br>此时1rem 不管在5上还是6上显示都完全跟在设计稿中显示效果相同</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//html</span></div><div class="line">&lt;meta name=<span class="string">"viewport"</span> content=<span class="string">"width=device-width, initial-scale=1.0"</span>&gt;</div><div class="line"><span class="comment">//动态计算rem</span></div><div class="line"><span class="keyword">var</span> domDocEL = <span class="built_in">window</span>.document.documentElement,</div><div class="line">    mateViewPort = <span class="built_in">window</span>.document.querySelector(<span class="string">'meta[name="viewport"]'</span>),</div><div class="line">    nBasePsdWidth = <span class="number">750</span> / <span class="number">100</span>,</div><div class="line">    nDpr = <span class="built_in">window</span>.devicePixelRatio,</div><div class="line">    nScale = <span class="number">1</span> / nDpr,</div><div class="line">    nLayout = domDocEL.clientWidth,</div><div class="line">    nRem = nLayout * nDpr / nBasePsdWidth;</div><div class="line">domDocEL.style.fontSize = rem +<span class="string">'px'</span>;</div><div class="line">mateViewPort.setAttribute(<span class="string">'content'</span>,<span class="string">'width='</span>+nDpr*nLayout+<span class="string">',initial-scale='</span>+nScale+<span class="string">',maximum-scale='</span>+nScale+<span class="string">',minimum-scale='</span>+nScale+<span class="string">',user-scalable=no'</span>);</div></pre></td></tr></table></figure>
<p>对于字体可以用写个mixin方法<br>根据不同的dpr设置字号</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">@mixin px2rem($name,$px) &#123;</div><div class="line">   [data-dpr="2"] &amp; &#123;</div><div class="line">     #&#123;$name&#125;: $px*2/2+px;</div><div class="line">    &#125;</div><div class="line">  &#125;</div></pre></td></tr></table></figure>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>移动端布局将viewport设成物理像素的大小,然后在缩放为dpr的倒数倍。<br>dpr不存在？<br>简单点~~~<br>那就指定为1！</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;/assets/blogImg/rem-dpr.png&quot; alt=&quot;px&quot;&gt;&lt;br&gt;
    
    </summary>
    
    
      <category term="css" scheme="//blog.fenghou.site/tags/css/"/>
    
      <category term="rem" scheme="//blog.fenghou.site/tags/rem/"/>
    
  </entry>
  
  <entry>
    <title>react</title>
    <link href="//blog.fenghou.site/2016/12/18/2016-12-18-react/"/>
    <id>//blog.fenghou.site/2016/12/18/2016-12-18-react/</id>
    <published>2016-12-18T11:06:01.000Z</published>
    <updated>2017-03-15T12:10:35.960Z</updated>
    
    <content type="html"><![CDATA[<p>react<br><a id="more"></a></p>
<p>在props里使用 onClick={ this.handleClick.bind(this) }<br>或者 onClick={ (e) =&gt; this.handleClick(e) }<br>或者 onClick={ ::this.handleClick }<br>都会产生性能问题，所以现在eslint在语法检查时就会阻止这几种写法，<br>问题原因是每一次render的时候如果遇到这些写法，<br>都会重新用handleClick函数与this去绑定从而重新创建一个新的函数，影响性能。<br>如果使用下面的写法则不会每次都创建：<br>// 1.<br>constructor() {<br>this.handleClick = this.handleClick.bind(this);<br>}<br>handleClick(e) { / … / }<br>// 2.<br>handleClick = (e) =&gt; { / … / };</p>
<p>箭头函数不能用？<br>Parsing error: Unexpected token =<br>babel-eslint</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;react&lt;br&gt;
    
    </summary>
    
    
      <category term="react" scheme="//blog.fenghou.site/tags/react/"/>
    
  </entry>
  
  <entry>
    <title>webpack配置</title>
    <link href="//blog.fenghou.site/2016/12/16/2016-12-16-webpack/"/>
    <id>//blog.fenghou.site/2016/12/16/2016-12-16-webpack/</id>
    <published>2016-12-16T11:05:13.000Z</published>
    <updated>2017-03-15T12:16:23.086Z</updated>
    
    <content type="html"><![CDATA[<p>关于webpack的教程网上一抓一大把<br>就不班门弄斧了<br>这里只是总结一些webpack的实用配置以及个人心得<br><a id="more"></a></p>
<h3 id="entry-amp-output"><a href="#entry-amp-output" class="headerlink" title="entry&amp;output"></a>entry&amp;output</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div></pre></td><td class="code"><pre><div class="line">enpty:&#123;</div><div class="line">    <span class="attr">index</span>:<span class="string">'./index.js'</span>,</div><div class="line">    <span class="attr">more</span>:[<span class="string">'./more2.js'</span>,<span class="string">'./more.js'</span>],</div><div class="line">    <span class="attr">vendor</span>: [<span class="string">'react'</span>, <span class="string">'react-dom'</span>, <span class="string">'react-router'</span>]</div><div class="line">&#125;</div><div class="line">putput:&#123;</div><div class="line">    <span class="attr">path</span>:<span class="string">'./build'</span>,</div><div class="line">    <span class="attr">filename</span>:<span class="string">'[name]-[id].js'</span>,</div><div class="line">    <span class="attr">publicPath</span>:<span class="string">'/assets/'</span>,</div><div class="line">    <span class="attr">chunkFilename</span>:<span class="string">'[name]-[chunkhash]'</span></div><div class="line">&#125;</div><div class="line"><span class="comment">//[id], chunk的id</span></div><div class="line"><span class="comment">//[name] ,chunk名</span></div><div class="line"><span class="comment">//[hash], 编译哈希值</span></div><div class="line"><span class="comment">//[chunkhash] , chunk的hash值  根据模块内容</span></div><div class="line"><span class="comment">//output.publicPath：设置为想要的资源访问路径。</span></div><div class="line"><span class="comment">//访问时，则需要通过类似http://localhost:8080/asstes/index-1.js来访问资源，</span></div><div class="line"><span class="comment">//如果没有设置，则默认从站点根目录加载。</span></div><div class="line"><span class="comment">//filename应该比较好理解，就是对应于entry里面生成出来的文件名。比如：</span></div><div class="line">&#123;</div><div class="line">    <span class="attr">entry</span>: &#123;</div><div class="line">        <span class="string">"index"</span>: <span class="string">"pages/index.jsx"</span></div><div class="line">    &#125;,</div><div class="line">    <span class="attr">output</span>: &#123;</div><div class="line">        <span class="attr">filename</span>: <span class="string">"[name].min.js"</span>,</div><div class="line">        <span class="attr">chunkFilename</span>: <span class="string">"[name].min.js"</span></div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="comment">//生成出来的文件名为index.min.js。</span></div><div class="line"><span class="comment">//chunkname我的理解是未被列在entry中，</span></div><div class="line"><span class="comment">//却又需要被打包出来的文件命名配置。</span></div><div class="line"><span class="comment">//什么场景需要呢？我们项目就遇到过，在按需加载（异步）模块的时候，</span></div><div class="line"><span class="comment">//这样的文件是没有被列在entry中的，如使用CommonJS的方式异步加载模块：</span></div><div class="line"><span class="built_in">require</span>.ensure([<span class="string">"modules/tips.jsx"</span>], <span class="function"><span class="keyword">function</span>(<span class="params">require</span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> a = <span class="built_in">require</span>(<span class="string">"modules/tips.jsx"</span>);</div><div class="line">    <span class="comment">// ...</span></div><div class="line">&#125;, <span class="string">'tips'</span>);</div><div class="line"><span class="comment">//异步加载的模块是要以文件形式加载哦，</span></div><div class="line"><span class="comment">//所以这时生成的文件名是以chunkname配置的，</span></div><div class="line"><span class="comment">//生成出的文件名就是tips.min.js。</span></div><div class="line"><span class="comment">//（require.ensure() API的第三个参数是给这个模块命名，</span></div><div class="line"><span class="comment">//否则 chunkFilename: "[name].min.js" 中的 [name] 是一个自动分配的、可读性很差的id，</span></div><div class="line"><span class="comment">//这是我在文档很不起眼的地方788发现的。。。）</span></div><div class="line"><span class="keyword">new</span> webpack.optimize.CommonsChunkPlugin(&#123;</div><div class="line">          <span class="attr">names</span>: [<span class="string">'vendor'</span>],</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<h3 id="url-loader"><a href="#url-loader" class="headerlink" title="url-loader"></a>url-loader</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">test: <span class="regexp">/\.(gif|jpg|png)$/</span>,</div><div class="line"><span class="attr">loader</span>: <span class="string">'url-loader?limit=1024&amp;name=img/[name].[ext]'</span></div><div class="line"><span class="comment">//小于1024字节 采用base64</span></div><div class="line"><span class="comment">//大于1024字节 正常打包到output目录下img文件夹中</span></div></pre></td></tr></table></figure>
<h3 id="js-loader"><a href="#js-loader" class="headerlink" title="js-loader"></a>js-loader</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//babel</span></div><div class="line"> <span class="comment">//配置 .babelrc</span></div><div class="line"> <span class="comment">//.rc run command 程序启动阶段被调用</span></div><div class="line"> <span class="comment">//执行babal-loader时自动执行</span></div><div class="line"> &#123;</div><div class="line">   <span class="string">"presets"</span>: [<span class="string">"es2015"</span>, <span class="string">"stage-2"</span>],</div><div class="line">   <span class="string">"plugins"</span>: [</div><div class="line">     <span class="string">"transform-class-properties"</span>,</div><div class="line">     <span class="string">"transform-runtime"</span></div><div class="line">   ]</div><div class="line"> &#125;</div><div class="line"> <span class="comment">//webpack.config.js</span></div><div class="line"> &#123;</div><div class="line">    <span class="attr">test</span>: <span class="regexp">/\.js$/</span>,</div><div class="line">    <span class="attr">exclude</span>: <span class="regexp">/node_modules/</span>,</div><div class="line">    <span class="attr">loader</span>:<span class="string">'babel'</span></div><div class="line"> &#125;,</div><div class="line"><span class="comment">//不使用.babelrc</span></div><div class="line"> &#123;</div><div class="line">   <span class="attr">test</span>: <span class="regexp">/\.js$/</span>,</div><div class="line">   <span class="attr">exclude</span>: <span class="regexp">/node_modules/</span>,</div><div class="line">   <span class="attr">loader</span>: <span class="string">'babel'</span>,</div><div class="line">   <span class="attr">query</span>: &#123;</div><div class="line">       <span class="attr">presets</span>: [<span class="string">"es2015"</span>, <span class="string">"stage-2"</span>],</div><div class="line">       <span class="attr">plugins</span>: [</div><div class="line">           <span class="string">"transform-class-properties"</span>,</div><div class="line">           <span class="string">"transform-runtime"</span></div><div class="line">           ]</div><div class="line">        &#125;</div><div class="line">   &#125;,</div></pre></td></tr></table></figure>
<h3 id="vue-loader"><a href="#vue-loader" class="headerlink" title="vue-loader"></a>vue-loader</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">   <span class="attr">test</span>: <span class="regexp">/\.js$/</span>,</div><div class="line">   <span class="attr">loader</span>: <span class="string">'babel'</span>,</div><div class="line">   <span class="attr">exclude</span>: <span class="regexp">/node_modules/</span>,</div><div class="line">&#125;</div><div class="line">&#123;</div><div class="line">   <span class="attr">test</span>:<span class="regexp">/\.vue$/</span>,</div><div class="line">   <span class="attr">loader</span>:<span class="string">'vue'</span>,</div><div class="line">&#125;</div><div class="line">babel: &#123;</div><div class="line">        <span class="attr">presets</span>: [<span class="string">'es2015'</span>],</div><div class="line">        <span class="attr">plugins</span>: [<span class="string">"transform-class-properties"</span>,</div><div class="line">                  <span class="string">"transform-runtime"</span>]</div><div class="line">&#125;,</div><div class="line"><span class="attr">vue</span>:&#123;</div><div class="line">    <span class="attr">loaders</span>:&#123;</div><div class="line">       <span class="attr">js</span>:<span class="string">'babel'</span>,</div><div class="line">       <span class="attr">scss</span>:[<span class="string">'vue-style-loader'</span>,<span class="string">'css'</span>,<span class="string">'sass'</span>].join(<span class="string">'!'</span>)</div><div class="line">    &#125;</div><div class="line">&#125;,</div></pre></td></tr></table></figure>
<h3 id="css-loader"><a href="#css-loader" class="headerlink" title="css-loader"></a>css-loader</h3><p>loader 采取管道流</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">loader: [<span class="string">'style'</span>,<span class="string">'css'</span>,<span class="string">'scss'</span>].join(<span class="string">'!'</span>)</div></pre></td></tr></table></figure>
<p>提取样式到单独文件<br>插件 extract-text-webpack-plugin</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> ExtractTextPlugin = <span class="built_in">require</span>(<span class="string">'extract-text-webpack-plugin'</span>);</div><div class="line">&#123;</div><div class="line">   <span class="attr">test</span>: <span class="regexp">/\.(scss|sass|css)$/</span>,</div><div class="line">   <span class="attr">loader</span>: ExtractTextPlugin.extract(<span class="string">'style-loader'</span>, <span class="string">'css-loader'</span>)</div><div class="line">&#125;</div><div class="line">plugins: [</div><div class="line">        <span class="keyword">new</span> ExtractTextPlugin(<span class="string">'[name].css'</span>)</div><div class="line">        <span class="comment">//output目录下</span></div><div class="line">  ],</div></pre></td></tr></table></figure>
<p>css样式自动 fix<br>插件 autoprefixer(postcss插件)</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">    <span class="attr">test</span>: <span class="regexp">/\.(scss|sass|css)$/</span>,</div><div class="line">    <span class="attr">loader</span>: ExtractTextPlugin.extract(<span class="string">'style-loader'</span>, [<span class="string">'css-loader'</span>, <span class="string">'postcss-loader'</span>])</div><div class="line"> &#125;</div><div class="line"><span class="keyword">const</span> AUTOPREFIXER_BROWSERS = [</div><div class="line">    <span class="string">'Android &gt;= 4'</span>,</div><div class="line">    <span class="string">'Chrome &gt;= 35'</span>,</div><div class="line">    <span class="string">'Firefox &gt;= 31'</span>,</div><div class="line">    <span class="string">'Explorer &gt;= 9'</span>,</div><div class="line">    <span class="string">'iOS &gt;= 7'</span>,</div><div class="line">    <span class="string">'Opera &gt;= 12'</span>,</div><div class="line">    <span class="string">'Safari &gt;= 7.1'</span></div><div class="line">]</div><div class="line"> postcss: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">         <span class="keyword">return</span> [autoprefixer(&#123; <span class="attr">browsers</span>: AUTOPREFIXER_BROWSERS &#125;)];</div><div class="line">   &#125;,</div></pre></td></tr></table></figure>
<h3 id="file-loader"><a href="#file-loader" class="headerlink" title="file-loader"></a>file-loader</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">      <span class="attr">test</span>: <span class="regexp">/\.(woff|svg|eot|ttf).$/</span>,</div><div class="line">      <span class="attr">loader</span>: <span class="string">"file-loader?name=fonts/[name].[ext]"</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="resolve"><a href="#resolve" class="headerlink" title="resolve"></a>resolve</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> moment = <span class="built_in">require</span>(<span class="string">'moment'</span>);</div><div class="line"><span class="comment">//编译很慢 也就是说，请求的是 moment 的源码。</span></div><div class="line"><span class="comment">//实际上，通过 NPM 安装 moment 的时候会同时安装 moment 的源码和压缩后的代码</span></div><div class="line"><span class="comment">//var moment = require('moment/min/moment-with-locales.min.js');</span></div><div class="line"><span class="comment">//只不过这样改，可读性会有所下降，</span></div><div class="line"><span class="comment">//而且每一个用到 moment 的地方都得这么写。</span></div><div class="line"><span class="comment">//另外，如果同样的问题出现在第三方模块中，修改别人代码就不那么方便了。</span></div><div class="line"><span class="comment">//下面来看看用 Webpack 怎么解决这个问题。</span></div><div class="line"> resolve: &#123;</div><div class="line">     <span class="attr">alias</span>: &#123;</div><div class="line">         <span class="attr">moment</span>: <span class="string">"moment/min/moment-with-locales.min.js"</span></div><div class="line">     &#125;</div><div class="line">   &#125;</div><div class="line"><span class="comment">//可以用 alias 指定从非npm引入的库，如</span></div><div class="line">jquery: path.resolve(__dirname, <span class="string">'./bower_components/jquery/dist/jquery.js'</span>) ，</div><div class="line">这样在 <span class="keyword">import</span> 时可以替换引用路径</div><div class="line"><span class="comment">// require时省略的扩展名，如：require('app') 不需要app.js</span></div><div class="line">extensions: [<span class="string">''</span>,<span class="string">'.js'</span>,<span class="string">'.vue'</span>,<span class="string">'.scss'</span>],</div></pre></td></tr></table></figure>
<h3 id="noParse"><a href="#noParse" class="headerlink" title="noParse"></a>noParse</h3><p>module.noParse 是 webpack 的另一个很有用的配置项，<br>如果你 确定一个模块中没有其它新的依赖 就可以配置这项，<br>webpack 将不再扫描这个文件中的依赖。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">module</span>: &#123;</div><div class="line">   <span class="attr">noParse</span>: [<span class="regexp">/moment-with-locales/</span>]</div><div class="line"> &#125;</div></pre></td></tr></table></figure></p>
<h3 id="devtool"><a href="#devtool" class="headerlink" title="devtool"></a>devtool</h3><p>通常，JavaScript的解释器会告诉你，第几行第几列代码出错。<br>但是，这对于转换后的代码毫无用处。<br>举例来说，jQuery 1.9压缩后只有3行，每行3万个字符，所有内部变量都改了名字。<br>你看着报错信息，感到毫无头绪，根本不知道它所对应的原始位置。<br>这就是Source map想要解决的问题。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">devtool: <span class="string">'#source-map'</span></div></pre></td></tr></table></figure>
<h3 id="hot-reload"><a href="#hot-reload" class="headerlink" title="hot reload"></a>hot reload</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//package.json</span></div><div class="line"><span class="string">"scripts"</span>: &#123;</div><div class="line">    <span class="string">"dev"</span>: <span class="string">"webpack-dev-server --devtool eval-source-map --progress --colors --hot --inline"</span>,</div><div class="line">    &#125;,</div><div class="line">--content-base 内容基本路径 不加默认当前目录</div><div class="line">--colors       输出加颜色</div><div class="line">path: <span class="string">"./dist"</span>,</div><div class="line"><span class="attr">filename</span>: <span class="string">"[name].js"</span>,</div><div class="line"><span class="attr">publicPath</span>: <span class="string">"abababab"</span>,</div><div class="line">publicPath 必须设置 这里设置什么名 html里引用就写什么名字</div><div class="line">&lt;script src=<span class="string">"/abababab/main.js"</span>&gt;&lt;/script&gt;</div><div class="line">npm run dev</div></pre></td></tr></table></figure>
<h3 id="webpack-w"><a href="#webpack-w" class="headerlink" title="webpack -w"></a>webpack -w</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//webstrom 会在临时文件夹中创建一个文件用来保存(好像没有出发实际文件的变更)</span></div><div class="line">setting</div><div class="line">Appearance &amp; Behavior</div><div class="line">System Settings</div><div class="line">Use <span class="string">"safe write"</span>(save changes to a temporary file first) 勾去掉</div></pre></td></tr></table></figure>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;关于webpack的教程网上一抓一大把&lt;br&gt;就不班门弄斧了&lt;br&gt;这里只是总结一些webpack的实用配置以及个人心得&lt;br&gt;
    
    </summary>
    
    
      <category term="webpack" scheme="//blog.fenghou.site/tags/webpack/"/>
    
  </entry>
  
  <entry>
    <title>学点运维，配个服务器</title>
    <link href="//blog.fenghou.site/2016/12/15/2016-12-15-aliyun-yunwei/"/>
    <id>//blog.fenghou.site/2016/12/15/2016-12-15-aliyun-yunwei/</id>
    <published>2016-12-15T11:04:25.000Z</published>
    <updated>2017-03-15T12:19:34.414Z</updated>
    
    <content type="html"><![CDATA[<p><img src="http://imgs.ebrun.com/resources/2016_11/2016_11_23/2016112329114798900788972.png" alt="aliyun"><br><a id="more"></a></p>
<p>前段时间和同事合租了一个阿里云服务器，60几块钱一个月。<br>服务器上的资源环境很多都是他配的，<br>作为前端，只是在上面放点静态的东西，也没太大兴趣在这方面去摸索<br>然后这货今天离职了。</p>
<p>走之前，悠悠然发了我一个连接<br>阿里云搞活动 服务器免费赠送6个月</p>
<p>果断入手(要买个9块钱的套餐)<br>然后<br>买域名<br>解析DNS<br>配nginx<br>装git<br>搭node</p>
<p>也算是小入门了</p>
<hr>
<p>But 我想说的是<br>作为一个开发人员and 一个合格的开发人员<br>首先具备的应该是解决问题，查找问题的能力</p>
<p>而不是一有问题不假思索的问别人<br>有时候多学一样本领,就早说一句求人的话</p>
<p>作为我们作为初学者<br>总会碰到各种各样的问题<br>那么，怎么解决？</p>
<h2 id="举个栗子"><a href="#举个栗子" class="headerlink" title="举个栗子"></a>举个栗子</h2><p>linux git的安装</p>
<p>忽略前面下载解压过程</p>
<blockquote>
<p>./configure –prefix=/usr/local<br>  make &amp; make install</p>
</blockquote>
<p>果断报错。。<br>OK 下载各种依赖<br>报错<br>继续<br>安装成功<br>git –version<br>嗯 有版本号<br>easy嘛<br>然后 来 git clone ..<br>error:fatal: Unable to find remote helper for ‘https’<br>又报错，奔溃</p>
<p>这是因为Git环境没有安装完全，需要重新安装</p>
<blockquote>
<p>./configure –prefix=/usr/local<br>  make all doc<br>  make install install-doc install-man install-html</p>
</blockquote>
<p>继续 OK<br>问题解决</p>
<p>那么这解决问题的过程 就比解决问题来的跟有用<br>前提是问题是你自己解决的</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;http://imgs.ebrun.com/resources/2016_11/2016_11_23/2016112329114798900788972.png&quot; alt=&quot;aliyun&quot;&gt;&lt;br&gt;
    
    </summary>
    
    
      <category term="node" scheme="//blog.fenghou.site/tags/node/"/>
    
      <category term="linux" scheme="//blog.fenghou.site/tags/linux/"/>
    
  </entry>
  
  <entry>
    <title>In city</title>
    <link href="//blog.fenghou.site/2016/12/14/2016-12-14-incity/"/>
    <id>//blog.fenghou.site/2016/12/14/2016-12-14-incity/</id>
    <published>2016-12-14T11:03:52.000Z</published>
    <updated>2017-03-15T12:21:11.534Z</updated>
    
    <content type="html"><![CDATA[<p><img src="/assets/blogImg/city.jpg" alt="city"></p>
<a id="more"></a>
<p>悠然<br>随心<br>随性<br>随缘</p>
<p>杭州，省会<br>美丽的西湖（我也只去过西湖。。）<br>一年前，在这<br>我开启了前端之旅</p>
<p>那谁说过，在风口，是只猪也能飞起来。<br>何况是在杭州这样的互联网台风中。。</p>
<p>但是风过了，依然在飞的却是鹰</p>
<p>麻雀从不担心树枝会断<br>因为他相信的不是树枝<br>而是自己的翅膀</p>
<p>身处互联网大时代<br>机会很多，机遇很多<br>首先飞起来<br>然后去充实自己<br>不断学习不断进步</p>
<p>最后<br>风即使过了<br>我们也进化成了鹰</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;/assets/blogImg/city.jpg&quot; alt=&quot;city&quot;&gt;&lt;/p&gt;
    
    </summary>
    
    
      <category term="随想" scheme="//blog.fenghou.site/tags/%E9%9A%8F%E6%83%B3/"/>
    
  </entry>
  
  <entry>
    <title>Node-Spider</title>
    <link href="//blog.fenghou.site/2016/12/13/2016-12-13-node-spider/"/>
    <id>//blog.fenghou.site/2016/12/13/2016-12-13-node-spider/</id>
    <published>2016-12-13T11:03:06.000Z</published>
    <updated>2017-03-15T12:23:35.958Z</updated>
    
    <content type="html"><![CDATA[<p>Node学习入门，练习爬虫再适合不过了<br>这里通过爬区某图片网站近(10万张图片)的例子，介绍爬虫的过程<br><a id="more"></a></p>
<h3 id="爬虫分析设计"><a href="#爬虫分析设计" class="headerlink" title="爬虫分析设计"></a>爬虫分析设计</h3><p>抓取的是 ‘<a href="http://www.mzitu.com‘" target="_blank" rel="external">http://www.mzitu.com‘</a> 网站<br>图片大致有五个类目<br>每个类目下分页规则<br><a href="http://www.mzitu.com/类目/page/1" target="_blank" rel="external">http://www.mzitu.com/类目/page/1</a><br><a href="http://www.mzitu.com/类目/page/2" target="_blank" rel="external">http://www.mzitu.com/类目/page/2</a></p>
<p>每一个有25个专题<br>专题详情页 <a href="http://www.mzitu.com/专题id" target="_blank" rel="external">http://www.mzitu.com/专题id</a><br>专题详情页分页规则<br><a href="http://www.mzitu.com/专题id/1" target="_blank" rel="external">http://www.mzitu.com/专题id/1</a><br><a href="http://www.mzitu.com/专题id/2" target="_blank" rel="external">http://www.mzitu.com/专题id/2</a></p>
<p>因此第一次鉴于此 爬虫设计如下<br>先获取单个类目下专题(图片和Id)<br>专题图片根据 类目/当前page数/图片 路径保存<br>将获取的id暂存<br>知道获取完全部全部类目专题<br>然后开始获取专题详情<br>确定要获取的专题详情的所有分页数<br>最后爬区所有分页数</p>
<h3 id="用到的模块"><a href="#用到的模块" class="headerlink" title="用到的模块"></a>用到的模块</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> superagent = <span class="built_in">require</span>(<span class="string">'superagent'</span>); <span class="comment">//请求封装模块</span></div><div class="line"><span class="keyword">var</span> <span class="keyword">async</span> = <span class="built_in">require</span>(<span class="string">'async'</span>);  <span class="comment">//并发控制模块</span></div><div class="line"><span class="keyword">var</span> cheerio = <span class="built_in">require</span>(<span class="string">'cheerio'</span>); <span class="comment">//抓取页面dom节点模块</span></div><div class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">"fs"</span>);</div></pre></td></tr></table></figure>
<h3 id="数据准备"><a href="#数据准备" class="headerlink" title="数据准备"></a>数据准备</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> sUrl = <span class="string">'http://www.mzitu.com'</span>; <span class="comment">//爬取目标</span></div><div class="line"><span class="keyword">var</span> aItems = []; <span class="comment">//单个类目下需要爬取的链接</span></div><div class="line"><span class="keyword">var</span> aTagList = [<span class="string">'/'</span>,<span class="string">'/xinggan'</span>,<span class="string">'/japan'</span>,<span class="string">'/taiwan'</span>,<span class="string">'/mm'</span>]; <span class="comment">//所有类目</span></div><div class="line"><span class="keyword">var</span> aDirList = [<span class="string">'index'</span>,<span class="string">'xinggan'</span>,<span class="string">'japan'</span>,<span class="string">'taiwan'</span>,<span class="string">'mm'</span>]; <span class="comment">//爬取存放路径</span></div><div class="line"><span class="keyword">var</span> nCurrentTag = <span class="number">0</span>; <span class="comment">//当前爬取类目</span></div><div class="line"><span class="keyword">var</span> aIdList = []; <span class="comment">//专题Id</span></div><div class="line"><span class="keyword">var</span> aNextPage = []; <span class="comment">//专题详情</span></div><div class="line"><span class="keyword">var</span> aNxtItems = []; <span class="comment">//专题详情下需要爬区的链接</span></div></pre></td></tr></table></figure>
<h3 id="获取所有专题"><a href="#获取所有专题" class="headerlink" title="获取所有专题"></a>获取所有专题</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">start</span>(<span class="params">page</span>)</span>&#123;</div><div class="line">    superagent</div><div class="line">            .get(page)</div><div class="line">            .end(<span class="function"><span class="keyword">function</span> (<span class="params">err, response</span>) </span>&#123;</div><div class="line">                <span class="keyword">if</span> (err) &#123;</div><div class="line">                    <span class="built_in">console</span>.log(err.status);</div><div class="line">                &#125;</div><div class="line">                <span class="keyword">if</span> (response.status === <span class="number">200</span>) &#123;</div><div class="line">                    <span class="keyword">var</span> $ = cheerio.load(response.text);</div><div class="line">                &#125;</div><div class="line">                <span class="keyword">var</span> nPageLen = $(<span class="string">'.nav-links a.next'</span>).prev().text();  <span class="comment">// 获取页数</span></div><div class="line">                <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>;i &lt; nPageLen ;i++)&#123;</div><div class="line">                    aItems.push(page+<span class="string">'/page/'</span>+(i+<span class="number">1</span>));</div><div class="line">                &#125;</div><div class="line">                <span class="keyword">var</span> sName = page.replace(<span class="string">'http://www.mzitu.com'</span>,<span class="string">''</span>);</div><div class="line">                sName = sName ? sName : <span class="string">'index'</span>;</div><div class="line">                <span class="comment">// 新建类目 存放目录</span></div><div class="line">                fs.mkdir(__dirname+<span class="string">'/uploa/'</span>+sName.replace(<span class="string">'/'</span>,<span class="string">''</span>),<span class="function"><span class="keyword">function</span>(<span class="params">err</span>)</span>&#123;</div><div class="line">                    <span class="keyword">if</span>(err)&#123;</div><div class="line">                        <span class="keyword">throw</span> err</div><div class="line">                    &#125;</div><div class="line">                &#125;)</div><div class="line">                fetchPage();</div><div class="line">            &#125;);</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">fetchPage</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="keyword">var</span> concurrencyCount = <span class="number">0</span>;</div><div class="line">    <span class="keyword">var</span> fetchUrl = <span class="function"><span class="keyword">function</span>(<span class="params">url,callback</span>)</span>&#123;</div><div class="line">        <span class="keyword">var</span> fetchStart = <span class="keyword">new</span> <span class="built_in">Date</span>().getTime();</div><div class="line">        concurrencyCount++;</div><div class="line">        <span class="built_in">console</span>.log(<span class="string">'并发数'</span>+concurrencyCount+<span class="string">'====url:'</span>+url);</div><div class="line">        superagent.get(url)</div><div class="line">            .end(<span class="function"><span class="keyword">function</span>(<span class="params">err,res</span>)</span>&#123;</div><div class="line">                <span class="keyword">if</span>(err)&#123;</div><div class="line">                    <span class="comment">// callback(err,url);</span></div><div class="line">                    <span class="comment">// return next(err);</span></div><div class="line">                &#125;</div><div class="line">                <span class="keyword">var</span> time = <span class="keyword">new</span> <span class="built_in">Date</span>().getTime() - fetchStart;</div><div class="line">                <span class="comment">// console.log('抓取'+url+'成功,耗时'+time)</span></div><div class="line">                concurrencyCount--;</div><div class="line">                <span class="keyword">if</span>(res.status === <span class="number">200</span>)&#123;</div><div class="line">                    <span class="keyword">var</span> $ = cheerio.load(res.text);</div><div class="line">                &#125;</div><div class="line">                <span class="comment">//爬取数据处理</span></div><div class="line">                getDetail($,url,<span class="function"><span class="keyword">function</span>(<span class="params">rs</span>)</span>&#123;</div><div class="line">                    <span class="comment">// _html += rs;</span></div><div class="line">                &#125;)</div><div class="line">                callback();</div><div class="line">            &#125;)</div><div class="line">    &#125;</div><div class="line">    <span class="comment">// 控制并发数</span></div><div class="line">    <span class="keyword">async</span>.mapLimit(aItems,<span class="number">5</span>,<span class="function"><span class="keyword">function</span>(<span class="params">myUrl,callback</span>)</span>&#123;</div><div class="line">        fetchUrl(myUrl,callback);</div><div class="line">    &#125;,<span class="function"><span class="keyword">function</span>(<span class="params">err,result</span>)</span>&#123;</div><div class="line">        nCurrentTag++;</div><div class="line">        <span class="keyword">if</span>(nCurrentTag &lt; aTagList.length)&#123;</div><div class="line">            <span class="comment">// console.log('====================开始抓取下一个类目====================');</span></div><div class="line">            aItems = [];</div><div class="line">            start(sUrl+aTagList[nCurrentTag]);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">else</span>&#123;</div><div class="line">            <span class="built_in">console</span>.log(<span class="string">'====================开始抓取详情页========================='</span>);</div><div class="line">            <span class="comment">// getNextPage();</span></div><div class="line">        &#125;</div><div class="line">    &#125;)</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">getDetail</span>(<span class="params">$,url,callback</span>)</span>&#123;</div><div class="line">    <span class="comment">//确定图片名称</span></div><div class="line">    <span class="keyword">var</span> dirList = url.replace(<span class="string">'http://www.mzitu.com/'</span>,<span class="string">''</span>).split(<span class="string">'/'</span>);</div><div class="line">    <span class="keyword">var</span> dirName = dirList[<span class="number">0</span>]+<span class="string">'/'</span>+dirList[<span class="number">1</span>]+dirList[<span class="number">2</span>];</div><div class="line">    <span class="keyword">if</span>(dirList.length &lt; <span class="number">3</span>)&#123;</div><div class="line">       dirName = <span class="string">'index/'</span>+dirList[<span class="number">0</span>]+dirList[<span class="number">1</span>];</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">var</span> domItemA = $(<span class="string">'#pins li a'</span>); <span class="comment">// 获取Id</span></div><div class="line">    <span class="keyword">var</span> domItem = $(<span class="string">'#pins li a img'</span>); <span class="comment">//获取图片</span></div><div class="line">    <span class="keyword">var</span> srcList = []</div><div class="line">    domItem.each(<span class="function"><span class="keyword">function</span>(<span class="params">idx,element</span>)</span>&#123;</div><div class="line">        <span class="keyword">var</span> $ele = $(element);</div><div class="line">        <span class="keyword">var</span> src = $ele.attr(<span class="string">'data-original'</span>);</div><div class="line">        <span class="keyword">var</span> id = $ele.parent().attr(<span class="string">'href'</span>).replace(<span class="string">'http://www.mzitu.com/'</span>,<span class="string">''</span>);</div><div class="line">        aSrcList.push(src);</div><div class="line">        aIdList.push(id);</div><div class="line">    &#125;)</div><div class="line">    <span class="comment">// 下载专题图片</span></div><div class="line">    downImg(aSrcList,dirName);</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">downImg</span>(<span class="params">list,dirName</span>)</span>&#123;</div><div class="line">    fs.mkdir(__dirname+<span class="string">'/upload/'</span>+dirName,<span class="function"><span class="keyword">function</span>(<span class="params">err</span>)</span>&#123;</div><div class="line">        <span class="keyword">if</span>(err)&#123;</div><div class="line">            <span class="keyword">throw</span> err</div><div class="line">        &#125;</div><div class="line">    &#125;)</div><div class="line">    <span class="keyword">var</span> savePath = __dirname+<span class="string">'/uploa/'</span>+dirName+<span class="string">'/'</span> + narr[<span class="number">0</span>]  +<span class="string">'_'</span>+ narr[<span class="number">1</span>] + <span class="string">'_'</span> + narr[<span class="number">2</span>];</div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">binaryParser</span>(<span class="params">res, callback</span>) </span>&#123;</div><div class="line">            res.setEncoding(<span class="string">'binary'</span>);</div><div class="line">            <span class="keyword">var</span> imgData = <span class="string">''</span>;</div><div class="line">            res.on(<span class="string">'data'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">chunk</span>) </span>&#123;</div><div class="line">                imgData += chunk;</div><div class="line">            &#125;);</div><div class="line">            res.on(<span class="string">'end'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">                fs.writeFile(savePath, <span class="keyword">new</span> Buffer(imgData, <span class="string">'binary'</span>),<span class="function"><span class="keyword">function</span>(<span class="params">err</span>) </span>&#123;</div><div class="line">                            <span class="keyword">if</span>(err) &#123;</div><div class="line">                                <span class="built_in">console</span>.log(err);</div><div class="line">                            &#125;</div><div class="line">                            <span class="built_in">console</span>.log(url+<span class="string">'下载成功'</span>)</div><div class="line">                        &#125;);</div><div class="line">            &#125;);</div><div class="line">        &#125;</div><div class="line">    <span class="keyword">var</span> downUrl = <span class="function"><span class="keyword">function</span>(<span class="params">url,callback</span>)</span>&#123;</div><div class="line">        <span class="keyword">var</span> narr = url.replace(<span class="string">"http://i.meizitu.net/thumbs/"</span>, <span class="string">""</span>).split(<span class="string">"/"</span>)</div><div class="line">        supergent.get(url)</div><div class="line">        <span class="comment">// .pipe(fs.createWriteStream(savePath))</span></div><div class="line">                .parse(binaryParser)</div><div class="line">                .end(<span class="function"><span class="keyword">function</span>(<span class="params">err,res</span>)</span>&#123;</div><div class="line">                &#125;)</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">async</span>.mapLimit(list,<span class="number">5</span>,<span class="function"><span class="keyword">function</span>(<span class="params">myUrl,callback</span>)</span>&#123;</div><div class="line">        downUrl(myUrl,callback);</div><div class="line">    &#125;,<span class="function"><span class="keyword">function</span>(<span class="params">err,result</span>)</span>&#123;</div><div class="line">    &#125;)</div><div class="line">&#125;</div></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;Node学习入门，练习爬虫再适合不过了&lt;br&gt;这里通过爬区某图片网站近(10万张图片)的例子，介绍爬虫的过程&lt;br&gt;
    
    </summary>
    
    
      <category term="node" scheme="//blog.fenghou.site/tags/node/"/>
    
  </entry>
  
  <entry>
    <title>Node-server</title>
    <link href="//blog.fenghou.site/2016/12/13/2016-12-13-node-server/"/>
    <id>//blog.fenghou.site/2016/12/13/2016-12-13-node-server/</id>
    <published>2016-12-13T11:02:26.000Z</published>
    <updated>2017-03-15T12:25:57.439Z</updated>
    
    <content type="html"><![CDATA[<p>用Node搭建一个静态资源访问服务器</p>
<a id="more"></a>
<p>用到的模块</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>),</div><div class="line">    url = <span class="built_in">require</span>(<span class="string">'url'</span>),</div><div class="line">    path = <span class="built_in">require</span>(<span class="string">'path'</span>),</div><div class="line">    fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</div></pre></td></tr></table></figure>
<p>思路 获取访问路径，以文件后缀判断文件类型<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> mimetype = &#123;</div><div class="line">    <span class="string">'txt'</span>: <span class="string">'text/plain'</span>,</div><div class="line">    <span class="string">'html'</span>: <span class="string">'text/html'</span>,</div><div class="line">    <span class="string">'css'</span>: <span class="string">'text/css'</span>,</div><div class="line">    <span class="string">'xml'</span>: <span class="string">'application/xml'</span>,</div><div class="line">    <span class="string">'json'</span>: <span class="string">'application/json'</span>,</div><div class="line">    <span class="string">'js'</span>: <span class="string">'application/javascript'</span>,</div><div class="line">    <span class="string">'jpg'</span>: <span class="string">'image/jpeg'</span>,</div><div class="line">    <span class="string">'jpeg'</span>: <span class="string">'image/jpeg'</span>,</div><div class="line">    <span class="string">'gif'</span>: <span class="string">'image/gif'</span>,</div><div class="line">    <span class="string">'png'</span>: <span class="string">'image/png'</span>,</div><div class="line">    <span class="string">'svg'</span>: <span class="string">'image/svg+xml'</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>获取请求的时候判断请求文件是否存在，决定返回的类型</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">http.createServer(<span class="function"><span class="keyword">function</span>(<span class="params">req,res</span>)</span>&#123;</div><div class="line">    <span class="keyword">var</span> pathname = url.parse(req.url).pathname,</div><div class="line">        realPath = path.join(__dirname,<span class="string">'/static'</span>,pathname);</div><div class="line">    <span class="keyword">var</span> body = [];</div><div class="line">    req.on(<span class="string">'data'</span>,<span class="function"><span class="keyword">function</span>(<span class="params">data</span>)</span>&#123;</div><div class="line">        body.push(data);</div><div class="line">    &#125;)</div><div class="line">    req.on(<span class="string">'end'</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">        body = Buffer.concat(body);</div><div class="line">    &#125;)</div><div class="line">    fs.exists(realPath,<span class="function"><span class="keyword">function</span>(<span class="params">ex</span>)</span>&#123;</div><div class="line">        <span class="keyword">if</span>(ex)&#123;</div><div class="line">            <span class="keyword">var</span> rs = fs.createReadStream(realPath);</div><div class="line">            res.writeHead(<span class="number">200</span>,&#123;</div><div class="line">                <span class="string">'Content-Type'</span>:mimetype[realPath.split(<span class="string">'.'</span>).pop()] || <span class="string">'text/plain'</span></div><div class="line">            &#125;)</div><div class="line">            rs.on(<span class="string">'data'</span>,res.write.bind(res))</div><div class="line">            rs.on(<span class="string">'close'</span>,res.end.bind(res));</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">else</span>&#123;</div><div class="line">            page_404(req,res,realPath); <span class="comment">//错误页面</span></div><div class="line">        &#125;</div><div class="line">    &#125;)</div><div class="line">&#125;).listen(<span class="number">3000</span>)</div></pre></td></tr></table></figure>
<p>请求不存在</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">page_404</span>(<span class="params">req,res,path</span>)</span>&#123;</div><div class="line">    res.writeHead(<span class="number">404</span>,&#123;</div><div class="line">        <span class="string">'Content-Type'</span>:<span class="string">'text/html'</span></div><div class="line">    &#125;)</div><div class="line">    res.write(<span class="string">'&lt;!doctype html&gt;\n'</span>);</div><div class="line">    res.write(<span class="string">'&lt;title&gt;404 Not Found&lt;/title&gt;\n'</span>);</div><div class="line">    res.write(<span class="string">'&lt;h1&gt;Not Found&lt;/h1&gt;'</span>);</div><div class="line">    res.write(</div><div class="line">        <span class="string">'&lt;p&gt;The requested URL '</span> +</div><div class="line">        path +</div><div class="line">        <span class="string">' was not found on this server.&lt;/p&gt;'</span></div><div class="line">    );</div><div class="line">    res.end();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;用Node搭建一个静态资源访问服务器&lt;/p&gt;
    
    </summary>
    
    
      <category term="node" scheme="//blog.fenghou.site/tags/node/"/>
    
  </entry>
  
</feed>
